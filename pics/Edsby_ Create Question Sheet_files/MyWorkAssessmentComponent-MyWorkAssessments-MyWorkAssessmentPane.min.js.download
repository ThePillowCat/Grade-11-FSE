/*
Copyright CoreFour Inc.
Version: baf4caef7b0dd7471dd76c3dc5db25e58fe75145ce31e12f9f3da02c27b2a1fb
Compiled: 1674920017
*/
cf.resources.confirm("MyWorkAssessmentComponent-MyWorkAssessments-MyWorkAssessmentPane", function(){

/*MyWorkAssessmentComponent*/
"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}cf.resource("MyWorkAssessmentComponent",function(t,n,e){return{component:function(n){if(n.arg("showTitle",!1),n.inherit("MyWorkAssessments.assessment"),n.data.classifications)for(var e in n.data.classifications)n.attr("data-cl-".concat(e),!0);var o=n.state.top().get("ur"),a=0;for(var s in o){var r=o[s];"object"===_typeof(r)&&r[n.nid()]&&(a+=r[n.nid()],n.attr("data-unread-".concat(s),r[n.nid()]))}a>0&&(n.attr("data-unread",!0),n.addClass(t.css.unread)),n.on("click",function(t){t.find(".xds-controls-toggleIcon").first().trigger("xds-controls-internal-toggle")})},files:function(t){},contents:function(t){t.data&&(t.data.gradecomment&&t.data.gradecomment.comment||t.data.studentnotes||t.data.studentfiles&&Array.isArray(t.data.studentfiles)&&t.data.studentfiles.length>0)||t.exitBlank()},showDueDate:function(n){var e=t.parseDate(n.data.date),o=n.state.peek("esubmit"),a=n.state.get("submissionCount")||0;("number"==typeof o&&o>0&&0!==a||e>=new Date)&&n.exitBlank()}}});

/*MyWorkAssessments*/
"use strict";cf.resource("MyWorkAssessments",function(e,s,t,a){return{types:{assessment:function(s){var t=s.get_setting("student");if(t&&s.data.individualAssessment&&s.data.studentAssigned&&!s.data.studentAssigned[parseInt(t)])s.exitBlank();else{var d=e.get("gradebook")[s.nid("node")],o=d.students[s.siblings.snid||e.gbl.user.nid].grades[s.nid()];bookGrades.publish.assessment(s);var n,i=s.data.gs,r=[],l=[];if(i){n=i.title;var u=s.data.columns?s.data.columns:s.data.colweights;if(u){var g=[];if("points"===i.mapping&&!i.customMapping){for(var m in i.cols)u[m]&&0!==parseInt(u[m])&&g.push((i.cols[m].shortName?i.cols[m].shortName:i.title?i.title:"")+"/"+u[m]);g.length>0&&(n=g.join(" ")),"gs_outof"===s.data.scheme&&u[0]&&(n=e.tpl(e.lang("Out of {{outof}}"),{outof:u[0]}))}if(o){var c=d.publishedGrade(s.data,o);if("perspective"===s.get_setting("mode")||"1"==s.data.published){var p,h,v={};if("perspective"!==s.get_setting("mode")&&s.get_val("hideWeights","node")||d.currentReportingPeriod&&d.activeNid!=d.currentReportingPeriod.nid&&1!=d.AverageType)h=!1;else if(h=!0,o.d||0==s.data.summative)l.push("-"),p="-";else if(s.data.resolvedWeightings)if(p=s.data.resolvedWeightings.percent,s.data.resolvedWeightings.subBuckets&&c.rcols.length&&!s.data.resolvedWeightings.unitBucket){for(var f in s.data.resolvedWeightings.subBuckets)v[s.data.resolvedWeightings.subBuckets[f].subBucket]=s.data.resolvedWeightings.subBuckets[f];for(var b in c.rcols)v[c.rcols[b].id]&&v[c.rcols[b].id].percent!==a&&l.push(v[c.rcols[b].id].percent)}else l.push(s.data.resolvedWeightings.percent);if(""!=c.total&&0!=c.total){var _,k=c.total;if(0!=c.norm&&""!=c.norm&&(k="<span class='MyWorkAssessments-grade-total'>"+c.total+"</span>"),!s.data.resolvedWeightings||!s.data.resolvedWeightings.subBuckets||s.data.resolvedWeightings.unitBucket||s.data.resolvedWeightings.subBuckets&&!c.rcols.length)_=h&&""!=p?"".concat(e.lang("Overall")," (").concat(p,")"):e.lang("Overall"),r.push({column:_,grade:k})}for(var y in c.rcols){var x=void 0;x=h&&""!=p&&v[c.rcols[y].id]?"".concat(c.rcols[y].name," (").concat(v[c.rcols[y].id].percent,")"):c.rcols[y].name,r.push({column:x,grade:c.rcols[y].result})}}else r.push({column:"&nbsp;",grade:"<div class='MyWorkAssessments-statusBubble MyWorkAssessments-statusBubble-notshared'>"+e.lang("Not Shared")+"</div>"})}}}var W=e.lookup("AssessmentAverageTypes",s.data.averageType).params,A=e.parseDate(s.data.adate),C=new Date;s.data.studentNotes&&s.data.studentNotes.indexOf("<")>=0&&(s.data.studentNotes=!1);var w=s.data.individualAssessment&&"perspective"===s.get_setting("mode");w&&s.state.set("showIndividualTag",w),s.map({createid:s.data.createid,creatorpic:s.data.creatorpic,discussion:s.data.commentCount,esubmissions:s.data.submissionCount,studentfiles:s.data.studentFiles,studentnotes:s.data.studentNotes,date:s.data.adate,type:s.data.type,name:s.data.assessmentName,scheme:n,comment:o.c,summative:"1"!=s.data.summative&&(W?W.label:""),relDue:s.data.adate,submitButton:s.data.submitButton,status:A<C&&s.data.esubmit&&!o.e&&!o.r&&-1===s.data.taskStatus?2:o.r,weight:l,bucket:r,dropped:o.d,flag:o.f&&"0"!==o.f?o.f:0,esubmit:s.data.esubmit,oltAttempts:s.data.oltAttempts,feedbody:s.data.feedbody}),3!=s.data.state&&1==s.data.published||s.addClass("xds-MyWorkAssessments-hidden"),o.f&&"0"!==o.f?s.addClass("xds-MyWorkAssessments-flagged"):(s.addClass("xds-MyWorkAssessments-unflagged"),s.has_role("Class Owner")||s.addClass("xds-MyWorkAssessments-flaglock"))}},grade:function(s){s.get_val("published")?s.get_val("dropped")&&(s.tooltip=e.lang("This grade has been dropped from the average.")):(s.addSubClass("unpublished"),s.tooltip=e.lang("The grade for this assessment has not been publicly shared by the teacher.")),s.get_val("published")||s.get_setting("showunpublishedgrades")||s.exitBlank()},discussion:function(e){e.data>0?e.data="<div class='dataBook-discussion dataBook-discussion-exists'></div>":e.data=""},weight:function(s){"-"===s.data&&(s.tooltip=e.lang("This assessment does not contribute to the overall grade."))},sheetButton:function(e){e.get_val("rubric")&&(e.data={rubric:!0}),2==e.get_val("esubmit")&&(e.get_val("published")||e.has_role("Class Owner"))&&(e.data={test:!0})},assignmentType:function(s){if(s.inherit("text"),!s.displayVal&&!s.data){var t=s.get_val("nodetype")+"."+s.get_val("nodesubtype");s.displayVal=e.lookup("nt",t).string[1]+"&nbsp;"}},flag:function(s){s.displayVal=" ",s.xds.icon="flag",s.inherit("fa.glyph"),s.data&&(s.removeClass("fal"),s.addClass("fas"),s.addStyle("color","purple")),s.has_role("Class Owner")&&s.on("click",function(t){var a,d=e.get("gradebook")[s.nid("node")];t.stopPropagation(),a=s.data?0:1,d.saveGrade({snid:parseInt(s.get_setting("student")||s.get_val("snid")),attr:"f",value:a,xds:"grades",anid:s.nid()}),s.set(a);var o=a?"addClass":"removeClass",n=a?"removeClass":"addClass",i=s.get_xdo("*assessments");i[o]("xds-MyWorkAssessments-flagged"),i[n]("xds-MyWorkAssessments-unflagged"),s.update()})}},events:{toggleFeed:function(e,s,t){e.get_xdo("*commentRow").dom().is(":visible")?(e.get_xdo("*commentRow").dom().hide(),e.get_xdo("*questionLoader").dom().empty(),e.get_xdo("*questionLoader").removeClass("xdl-has-builds")):(e.get_xdo("*commentRow").dom().show(),e.trigger("loadFeed"))},toggleFeedOn:function(e,s,t){var a=e.get_xdo("*commentRow");a.temp.visible||(a.temp.visible=!0,a.dom().show(),e.trigger("loadFeed"))},toggleFeedOff:function(e,s,t){var a=e.get_xdo("*commentRow");a.temp.visible&&(a.temp.visible=!1,a.dom().hide(),e.get_xdo("*questionLoader").dom().empty(),e.get_xdo("*questionLoader").removeClass("xdl-has-builds"))},hideFeedForm:function(e,s,t){e.dom().addClass("MyWorkAssessments-assessments-questionLoader-hidden"),setTimeout(function(){e.dom().empty(),e.dom().removeClass("xdl-has-builds"),e.dom().removeClass("MyWorkAssessments-assessments-questionLoader-hidden")},400),e.dom().css("height",""),e.get_xdo("*commentRow").dom().show(),e.trigger("redrawFeed")},adjustHeight:function(e,s,t){var a=e.get_arg("count"),d=a?1:-1;a<=1&&e.dom().height(e.dom().height()+500*d)},commentPosted:function(e,s,t){var a=e.get_xdo("*discussion");""===a.data&&(a.parent_xdo().map({discussion:1}),a.parent_xdo().update())}}}});

/*MyWorkAssessmentPane*/
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}cf.resource("MyWorkAssessmentPane",function(e,t,s,r){return new e.classes.XDSResource("MyWorkAssessmentPane",{pane:function(e){e.arg("showunpublishedgrades")&&e.set_setting("showunpublishedgrades",1),e.arg("mode")&&e.set_setting("mode",e.arg("mode")),e.get_setting("filter")&&e.ready(function(e){e.trigger("toggleFilter",{filter:e.get_setting("filter")})}),e.on("toggleFilter",function(e){var t=e.get_arg("filter");e.find(".xds-MyWorkAssessmentComponent-component").show(),e.temp.activeFilter===t?e.temp.activeFilter=!1:(e.temp.activeFilter=t,e.find(".xds-MyWorkAssessmentComponent-component:not([data-cl-".concat(t,"])")).hide())})},init:function(t){!t.get_setting("student")&&t.has_role("Student")&&t.set_setting("student",e.gbl.user.nid);var s=0,r=0,n=0,o=0,a=0,i=t.get_val("assignments"),d={};for(var u in i){var m=i[u];d[m.nid]=m}var l=e.get("gradebook")[t.nid("node")],c=t.get_val("snid")||t.get_setting("student"),g=t.get_val("rid"),p=t.get_setting("unit")||"all",v=t.get_setting("type")||"all",f=l.students[c];!l.activeNid&&l.currentReportingPeriod?l.setActiveAssessments(l.currentReportingPeriod.nid):l.currentReportingPeriod&&l.activeNid!=l.currentReportingPeriod.nid&&(t.siblings.ShowAverage="1"),f||(l.register.student.call(l,{nid:c,grades:t.get_val("grades"),average:t.get_val("Average")}),f=l.students[c],l.normalizeAll(f));var y,h,b=t.state.top().get("ur")||{},_=f.normalized||{},A=f.grades||{},w=l.activeAssessments,S=l.calculateStudentWeighting(c),k=[],C=[],W=[],T=[],B=[];for(var D in w){var M=D;if((3!=(D=w[D]).state||t.has_role("Class Owner"))&&!("all"!=p&&p!=D.thread||"all"!=v&&v!=D.type)){e.parseDate(D.adate),new Date;y=_[D.nid],h=A[D.nid],D.resolvedWeightings=S[D.nid],!1===y.average&&(D.published=!1),!1===h.published&&(D.published=!1);var P=void 0;d[M]&&d[M].oltc&&(P=d[M].oltc[c]?d[M].oltc[c].length:0);d[M]&&(d[M].threadSummary?(D.commentCount=d[M].threadSummary.count,D.submissionCount=d[M].threadSummary.sub,D.mtime=d[M].threadSummary.mtime,D.studentFiles=d[M].threadSummary.studentfiles,D.studentNotes=d[M].studentNotes):D.commentCount=d[M].threadCount,D.submitButton=d[M].submitButton,D.taskStatus=d[M].taskStatus,D.oltAttempts=P,D.feedbody=d[M].feedbody,D.mtime=D.mtime||D.adate||D.date,D.createid=d[M].createid,D.creatorpic=d[M].creatorpic);var x=0;for(var R in b){var F=b[R];"object"===_typeof(F)&&F[M]&&(x+=F[M])}D.unread=x?1:0,D.published&&(D.commentCount=(D.commentCount||0)+1),D.overdue=0;var N=e.get("MyWork").utils.classifyAssessment(t,M,D,f,d,p,v);!1!==N&&(N.upcoming&&(k.push(D),s++),N.incomplete&&(C.push(D),r++),N.overdue&&(D.overdue=1),N.ungraded&&(W.push(D),n++),N.graded&&(T.push(D),o++),N.overdue&&a++,D.classifications=N,B.push(D))}}k=e.reverse(e.sort({sortBy:"adate,date",sortType:"date,date",sortDirection:"forward,forward"},k)),C=e.reverse(e.sort({sortBy:"adate,date",sortType:"date,date",sortDirection:"forward,forward"},C)),W=e.reverse(e.sort({sortBy:"adate,date",sortType:"date,date",sortDirection:"forward,forward"},W)),T=e.reverse(e.sort({sortBy:"adate,date",sortType:"date,date",sortDirection:"forward,forward"},T)),B=e.sort({sortBy:"unread,overdue,adate,date",sortType:"basic,basic,date,date",sortDirection:"reverse,reverse,reverse,reverse"},B);var z=t.parent_xdo();z&&z.map({incompleteTitle:r,incompleteAssessments:{snid:c,srid:g,assessments:C},upcomingTitle:s,upcomingAssessments:{snid:c,srid:g,assessments:k},gradedTitle:o,gradedAssessments:{snid:c,srid:g,assessments:T},ungradedTitle:n,ungradedAssessments:{snid:c,srid:g,assessments:W},allAssessments:{snid:c,srid:g,assessments:B}}),t.state.top().set({numIncompleteAssessments:r,numUpcomingAssessments:s,numGradedAssessments:o,numUngradedAssessments:n,numOverdueAssessments:a})},weightHeader:function(t){var s=e.get("gradebook")[t.nid("node")];(t.get_val("gradebook-hideWeights","node")||s.currentReportingPeriod&&s.activeNid!=s.currentReportingPeriod.nid&&1!=s.AverageType)&&(t.xds.title="&nbsp;")}},{toggleBoxVisibility:function(e,t,s){var r=[],n=e.parent_xdo().get_children();for(var o in n)"title"!==n[o].id&&r.push(e.get_xdo("sibling:"+n[o].id).dom());e.dom().hasClass("MyWork-collapsed")?(e.dom().removeClass("MyWork-collapsed"),r.forEach(function(e){e.show()})):(e.dom().addClass("MyWork-collapsed"),r.forEach(function(e){e.hide()}))}})});
});