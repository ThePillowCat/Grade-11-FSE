/**
 * Version: baf4caef7b0dd7471dd76c3dc5db25e58fe75145ce31e12f9f3da02c27b2a1fb
 * Bundle: evidence
 **/

cf.resources.confirm('bundle_evidence', function() {

/* resources: Evidence */

"use strict";cf.resource("Evidence",function(t,e,a){var s={change_student:function(t,e,a){var s=""+t.get_arg("student_nid");s!==t.state.peek("active_student")&&t.state.set("active_student",s)},open_organize:function(e,a,s){var n={},d=e.state.peek("active_student");d&&(n.student=d),t.get_module("tabbedform").set_active_tab(e,e.temp.tabset,e.arg("id"),e.nid(),e.arg("xds"),n)},open_story_args:function(e){for(var a,s=t.sort({sort:"last,first"},e.state.get("classStudents")||{}),n=e.state.peek("active_student"),d=Object.values(s),o=0;o<d.length;o++){var i=d[o];if(i.portfolioNid){if(n&&""+i.nid===n){a=i;break}a||(a=i)}}return!!a&&(e.state.set("active_student",""+a.nid),{nid:a.portfolioNid,xds:e.arg("xds"),params:{course:e.nid()}})},open_story:function(e,a,n){var d=s.open_story_args(e);d&&t.get_module("tabbedform").set_active_tab(e,e.temp.tabset,e.arg("id"),d.nid,d.xds,d.params),e.e.stopPropagation(),e.e.preventDefault()},setupModelNID:function(e){e.inherit("sys"),e.data?e.global("model",e.data):e.get_val("classNid")&&t.is_arr(e.get_val("classNid"))&&t.is_obj(e.get_val("classNid")[0])&&e.get_val("classNid")[0].nid?e.global("model",e.get_val("classNid")[0].nid):e.global("model",e.nid("gbl")),e.state.get("selectedStudents")||e.state.set("selectedStudents",{})},gather:function(t){var e=t.arg("xdsGather")||t.get_arg("xdsGather"),a=t;t.newEvent("lightbox.open",t.get_args()).then(function(t){if(t&&t.altprops&&t.altprops.selectedStudents){var s=Object.keys(t.altprops.selectedStudents).join(",");a.newEvent("lightbox",{xds:e,nid:a.nid(),class:a.nid(),model:a.state.get("modelNid"),command:"create",noPath:!0,student:s})}}).catch(function(t){})},reloadActiveTab:function(t){var e=t.target("*tabbedform");e&&e.xdo&&e.xdo.newEvent("tabbedform.reload_active_tab")}};return s});

/* resources: EvidenceCard */

"use strict";cf.resource("EvidenceCard",function(e,a,t,s){return{types:{quote:function(e){e.data&&(e.displayVal=" &#8220;"+e.data+"&#8221;")},pairedBlock:function(e){e.data&&(e.xds.sparse=!0),e.state.get(e.arg("pair"))||e.addStyle("height","100%")},shareIcon:function(e){56==e.data?(e.displayVal="",e.inherit("fa.glyph")):e.inherit("sys")}},events:{toggleSelect:function(e,a,t){e.hasClass("EvidenceCard-selected")?e.removeClass("EvidenceCard-selected"):e.addClass("EvidenceCard-selected")}}}});

/* resources: EvidenceCollaborate */

"use strict";cf.resource("EvidenceCollaborate",function(t,e,n,a){return{types:{iconRow:function(t){t.data&&(t.data=" "+t.data.replace(/,/g,", "),t.inherit("fa.icon"))}},showifs:{shared:function(e){return e.nt()==t.nt.Document.Evidence()&&"Teacher"!=e.state.get("showto")},unshared:function(e){return e.nt()==t.nt.Document.Evidence()&&"Teacher"==e.state.get("showto")}},events:{setSharedState:function(t){t.state.set("showto","Teacher,Parent,Student")},setUnsharedState:function(t){t.state.set("showto","Teacher")}}}});

/* resources: EvidenceGather */

"use strict";cf.resource("EvidenceGather",function(e,d,o){function t(d){if(d.origin===e.gbl.server){var o=d.data.split("-");if("EvidenceGatherClose"===o[0]){var t=e.get_node(o[1]);for(var n in t){var i=t[n];if("EvidenceGather-student"===i.cssPath)return i.get_xdo("*options").dom().show(),i.get_xdo("*loader").dom().empty(),void i.get_xdo("*commands").dom().hide()}}}}return{types:{},events:{gearToggle:function(e,d,o){e.find(".xds-EvidenceGather-checkbox",!0).toggle()},toggleCommands:function(e,d,o){e.get_xdo("*commands").dom().is(":visible")?(e.get_xdo("*options").dom().show(),e.get_xdo("*loader").dom().empty(),e.get_xdo("*commands").dom().hide()):(e.find(".xds-EvidenceGather-commandPane:visible",!0).hide(),e.get_xdo("*commands").dom().show())},loadForm:function(e,d,o){e.newEvent("lightbox",{xds:e.get_arg("xds"),nid:e.get_arg("nid"),class:e.nid("node"),model:e.state.get("modelNid"),command:"create",noPath:!0,student:e.nid()}),e.get_xdo("*commands").dom().hide()},registerFrameListener:function(e,o,n){d.addEventListener("message",t)},unregisterFrameListener:function(e,o,n){d.removeEventListener("message",t)},loadOrganize:function(e,d,o){e.caller().trigger("loadOrganize",{student:e.nid()})}}}});

/* resources: EvidenceGatherForm */

"use strict";cf.resource("EvidenceGatherForm",function(t,e,a,n){function s(t,e){["createSubmit","createandshareSubmit","editSubmit","editandshareSubmit"].forEach(function(a){e==a?t.state.set(a,!0):t.state.set(a,!1)})}return{init:function(t){t.state.set("conversationInput",t.get_setting("conversationInput")),t.inherit("sys")},load_gradebook:function(e,a,s){var i,d=e.caller(),r=d?d.caller():n;i=r&&r.global("classnid")?r.global("classnid"):r&&r.get_val("class_nid")?r.get_val("classnid"):r&&r.nt("node")===t.nt.Container.Class()?r.nid("node"):e.get_setting("class")||e.nid("gbl"),e.newEvent("loadxds",{nid:i,xds:e.get_arg("xds"),GradebookName:"evidenceGradebook",noPath:!0,noForm:!0,func:function(){e.trigger("evidenceGradebook-loaded")}})},standards:function(t){t.state.get("standards")||t.state.set("standards",[]);var e=t.state.get("standards");if(e.length){var a=[];for(var n in e){var s=e[n];a.push(s)}t.data={standard:a},t.addStyle("display","inline-block")}else e.length||t.data.standard&&delete t.data.standard},standardsData:function(t){t.inherit("sys"),t.data&&t.state.set("standards",t.data.split(","))},studentData:function(t){t.get_setting("student")?t.data=t.get_setting("student"):t.data=(t.state.get("students")||[]).map(function(t){return t.nid}),t.inherit("f_hidden")},evidenceTagData:function(t){var e=t.state.get("tagCloud"),a=[];for(var n in e)a.push(n);t.state.set("tagbank",a)},tagData:function(t){t.inherit("sys"),t.data&&t.state.set("tagInput",t.data)},tags:function(t){var e=t.state.get("tagCloud"),a=[];for(var n in e)a.push(n);t.data=t.get_setting("tags"),t.inherit("f_str",{choices:a})},tagPicker:function(t){var e=t.state.get("tagbank"),a=[];for(var n in e)a.push({display:e[n],value:e[n]});t.inherit("dd.combobox",{list:a})},updateStandards:function(t){var e=Object.keys(t.get_arg("standards"));t.state.set("standards",e),t.get_xdo("*standardsData").val(e.join(","))},shareButton:function(t){t.state.get("showto")&&"Teacher"!==t.state.get("showto")?(t.data="1",t.get_setting("editMode")?s(t,"editandshareSubmit"):s(t,"createandshareSubmit")):(t.data="0",t.get_setting("editMode")?s(t,"editSubmit"):s(t,"createSubmit")),t.inherit("f_checkbox")},shareToggle:function(t){"1"===t.val()?(t.state.set("showto","Teacher,Parent,Student"),t.get_setting("editMode")?s(t,"editandshareSubmit"):s(t,"createandshareSubmit")):(t.state.set("showto","Teacher"),t.get_setting("editMode")?s(t,"editSubmit"):s(t,"createSubmit"))},deleteEvidence:function(t){t.target("caller").trigger("newDataAvailable"),t.newEvent("lightbox.close")},submit:function(){function a(a){e.parent&&e.parent.postMessage("EvidenceGatherClose-"+a.get_setting("student"),t.gbl.server),a.caller()&&a.caller().trigger("newDataAvailable"),a.newEvent("lightbox.close")}return function(e,n,s){var i=t.get("gradebook"),d=e.get_arg("nid").substring(e.get_arg("nid").lastIndexOf("/")+1),r=!1;i&&e.has_write("grades")&&function(){for(var t=i[e.nid("gbl")]||i.evidenceGradebook,n=e.state.get("students"),s=!1,o=Object.values(n),g=0;g<o.length;g++){var c=o[g].nid;if(t&&c&&d){var u=e.global("grade")||{};for(var l in u)r=!0,t.saveGrade({snid:c,value:u[l],xds:"grades",anid:d,col:l,success:function(){s||(a(e),s=!0)}})}}}(),r||a(e)}}()}});

/* resources: EvidenceGatherFrameStandardSelector */

"use strict";cf.resource("EvidenceGatherFrameStandardSelector",function(e,t,a,d){var r;return{types:{init:function(t){var a=t.state.get("standards");if(!t.state.data.selectedStandards){var d={};if(t.get_setting("standards")){var s=t.get_setting("standards").split(",");for(var n in s)d[s[n]]={code:s[n].split(":")[1],fullcode:s[n]}}t.state.set("selectedStandards",d)}r=e.get("standards").construct(a)},frames:function(e){var t=[];if(r){for(var a=r.standardsTree;1===Object.keys(a).length;)a=a[Object.keys(a)[0]].children;for(var d in a)t.push({code:a[d].code,name:a[d].body,fullcode:a[d].fullcode})}e.data={frame:t}},standardPane:function(e){var t=[],a=e.state.get("selectedFrame");if(r){for(var d=r.standardsTree;1==Object.keys(d).length;)d=d[Object.keys(d)[0]].children;for(var s in d)if(d[s].fullcode==a){var n=[];for(d[s].children&&0!==Object.keys(d[s].children).length?n.push(d[s]):t.push(d[s]);n.length>0;){var l=n.shift();for(var c in l.children){var o=l.children[c];o.children&&Object.keys(o.children).length>0?n.push(o):t.push(o)}}}}e.data={standard:t}},selectedPane:function(e){var t=[],a=e.state.get("selectedStandards");if(a){for(var d in a)t.push(a[d]);e.data={selectedCodes:t}}},standard:function(e){e.data.display=e.get_val("code")+": "+e.get_val("body");var t=e.state.get("selectedStandards");t&&t[e.get_val("fullcode")]&&e.addClass("xds-EvidenceGatherFrameStandardSelector-standard-selected")},frame:function(e){e.data.display=e.get_val("code")+": "+e.get_val("name")}},events:{selectFrame:function(e,t,a){e.state.parent().set("selectedFrame",e.get_val("fullcode")),e.parent_xdo().find(".xds-EvidenceGatherFrameStandardSelector-frame-selected").removeClass("xds-EvidenceGatherFrameStandardSelector-frame-selected"),e.dom().addClass("xds-EvidenceGatherFrameStandardSelector-frame-selected")},selectStandard:function(e,t,a){var d=e.state.get("selectedStandards");d[e.get_val("fullcode")]?delete d[e.get_val("fullcode")]:d[e.get_val("fullcode")]={fullcode:e.get_val("fullcode"),code:e.get_val("code")},e.state.update("selectedStandards")},removeStandard:function(e,t,a){delete e.state.get("selectedStandards")[e.get_val("fullcode")],e.state.update("selectedStandards")},saveAndClose:function(e,t,a){var d=e.state.get("selectedStandards");e.target("caller").trigger("newData",{newData:Object.keys(d)}),e.newEvent("lightbox.close")}}}});

/* resources: EvidenceGatherPhoto */

"use strict";cf.resource("EvidenceGatherPhoto",function(e,t,a,n){return{load_gradebook:function(t,a,s){var d,r=t.caller(),o=r?r.caller():n;d=o&&o.global("classnid")?o.global("classnid"):o&&o.get_val("class_nid")?o.get_val("classnid"):o&&o.nt("node")===e.nt.Container.Class()?o.nid("node"):t.get_setting("class")||t.nid("gbl"),t.newEvent("loadxds",{nid:d,xds:t.get_arg("xds"),GradebookName:"evidenceGradebook",noPath:!0,noForm:!0,func:function(){t.trigger("evidenceGradebook-loaded")}})},select_student:function(e,t,a){e.newEvent("lightbox",{xds:e.get_arg("xds"),nid:e.get_setting("class"),students:e.get_xdo("*studentData").val(),noPath:!0}).then(function(t){if(t&&t.altprops&&t.altprops.selectedStudents){var a=t.altprops.selectedStudents;a&&(e.state.set("students",Object.values(a)),e.get_xdo("*studentData").val(Object.keys(a).join(",")))}})},students:function(e){var t,a=e.state.get("students");a||(a={},e.state.set("students",a)),t=!!Object.keys(a).length,e.state.set("has_students",t),t?(e.data={student:Object.values(a).map(function(e){return e.name})},e.addStyle("display","inline-block")):e.addStyle("display","none")},updateStandards:function(e){var t=Object.keys(e.get_arg("standards"));e.state.set("standards",t),e.get_xdo("*standardsData").val(t.join(","))},submit:function(){function a(a){t.parent&&t.parent.postMessage("EvidenceGatherClose-"+a.get_setting("student"),e.gbl.server),a.target("caller").trigger("newDataAvailable"),a.newEvent("lightbox.close")}return function(t,n,s){var d=e.get("gradebook"),r=t.get_arg("nid").substring(t.get_arg("nid").lastIndexOf("/")+1),o=!1;if(d&&t.has_write("grades"))for(var l=d[t.nid("gbl")]||d.evidenceGradebook,i=t.state.get("students"),g=Object.values(i),c=0;c<g.length;c++){var u=g[c].nid;if(l&&u&&r){var v=t.global("grade")||{};for(var b in v)o=!0,l.saveGrade({snid:u,value:v[b],xds:"grades",anid:r,col:b,success:function(){a(t)}})}}o||a(t)}}()}});

/* resources: EvidenceOrganize */

"use strict";cf.resource("EvidenceOrganize",function(e,n,t,i){return{types:{init:function(e){}},events:{}}});
});
