/**
 * Version: baf4caef7b0dd7471dd76c3dc5db25e58fe75145ce31e12f9f3da02c27b2a1fb
 * Bundle: phase3
 **/

cf.resources.confirm('bundle_phase3', function() {

/* modules: LearningSupportRegistry */

"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}cf.module("LearningSupportRegistry",function(e,t,a,n){function r(t,a,r){try{if(!(t=JSON.parse(t)).length)return n;var s="";for(var o in t){var i=t[o],l=e.lookup("responseDetailType",i.rdetail).str(),d=e.lookup("responseTierType",i.tier).str(),p=e.lookup(r,i.Status).str();p&&d&&l&&(s+=e.tpl(a,{rdetail:l,tier:d,Status:p}))}return s=s.substring(0,s.length-2)}catch(e){return t}}function s(t,a){var r=arguments.length>2&&arguments[2]!==n&&arguments[2],s=!(arguments.length>3&&arguments[3]!==n)||arguments[3];try{s?t=JSON.parse(t):"object"==_typeof(t)&&t.length||(t=[""+t]);var o=[];for(var i in t){var l=t[i],d=e.lookup(a,l).str()||e.lookup(r,l).str();d&&o.push(d)}return o.join(",")}catch(e){return t}}return{types:{classesViewMore:function(e){var t=e.state.get("classes"),a=1,n=!1;for(var r in t)a>2?(t[r].displayClass=!1,n=!0):t[r].displayClass=!0,a++;n||e.addClass("hideClass"),e.ready(function(e){var a=e.get_xdo("*classeswrap");a.map({classes:t}),a.update()}),e.state.get("viewMoreActive")?e.displayVal=e.arg("titleCollapse"):e.displayVal=e.arg("titleExpand"),e.on("click",function(e){var t=!e.state.get("viewMoreActive");e.state.set("viewMoreActive",t),e.update()})},noteFeed:function(e){var t=e.nid(),a=e.state.get(t);e.state.set("notes",a),e.update()},notesViewMore:function(t){var a=t.state.get("notes").length;t.displayVal=e.tpl(t.arg("titleExpand"),{numNotes:a}),t.on("click",function(e){e.get_xdo("*notefeed").addClass("notes-expanded"),e.hide()})},LSRZoomPageTitle:function(t){var a=0,n=e.user.schools,r=t.arg("schoolNodeType")||2;for(var s in n){n[s].nodesubtype==r&&(a+=1)}t.displayVal=a>1?t.arg("title1+"):t.arg("title1")+" "+t.val()},LSRZoomYearLevelCol:function(t){if("ECE"===t.val()){var a=t.state.get("birthdate");if(!a)return;a=new Date(a);var n=new Date,r=Math.floor((n-a)/31536e6);t.displayVal=r<3?t.arg("title3-"):e.tpl(t.arg("title3+"),{yearlevel:r})}},LSRZoomResponseSummary:function(e){var t=e.state.get("rec"),a=e.arg("responseSummaryTemplate");for(var n in t){var o=t[n],i=o.internal,l=o.external,d=o.statuses,p=o.tiers,c=o.ethnicity;i&&(o.internal=r(i,a,"internalResponseStatusType")),l&&(o.external=r(l,a,"externalResponseStatusType")),(d=s(d,"internalResponseStatusType","externalResponseStatusType"))?o.statuses=d:delete o.statuses,(p=s(p,"responseTierType"))?o.tiers=p:delete o.tiers,(c=s(c,"ethnicitySuperType",!1,!1))?o.ethnicity=c:delete o.ethnicity}e.state.set("tabledata",{rec:t}),e.inherit("sys")},responseSummary:function(e){var t=e.arg("responseSummaryType"),a=e.arg("responseSummaryTemplate");t?"internal"==t?t="internalResponseSummaryType":"external"==t&&(t="externalResponseSummaryType"):t="internalResponseSummaryType",e.set(r(e.val(),a,t))},zoomExport:function(t){var a=e.user.schools,n=[],r=+t.arg("groupNodesubtype")||2;for(var s in a){var o=a[s];o.nodesubtype==r&&n.push(o.nid)}n=n.join(".");var i=new Date;i=i.toString();var l=e.tpl(t.arg("titlefooter"),{exportdate:i}),d="".concat(e.gbl.csvexport).concat(n,"?xds=").concat(t.arg("xds"),"&attachment=1&filename=").concat(t.arg("fname")||"LSRExport","&nodup=1&footer=1").concat(l);t.xds.href=d,t.inherit("loadPage")},lsrAdminConsentInit:function(t){var a=t.state.get("providers"),n=[],r=e.user.school?e.user.school.split("."):[];for(var s in r=r.map(function(e){return+e}),a){var o=a[s];(new Date(o.indate)-new Date)/864e5<30&&r.includes(o.nid)&&n.push({nid:o.nid,name:o.title,pcs:o.pconsent,pcsby:o.pconsentby})}t.state.set("parentalConsentRecs",n)}},addParentSchoolId:function(e){e.caller()&&e.caller().state.get("school")&&e.state.set("school",e.caller().state.get("school"))},addParentLoadEdit:function(e){e.newEvent("lightbox",{command:e.get_arg("command"),xds:e.get_arg("xds"),nodetype:e.get_arg("nodetype"),snid:e.get_arg("snid"),nid:e.caller().state.get("school")})},events:{responseTypeUpdated:function(e){var t=e.state.get("responsePicker"),a=e.state.get("detailPicker"),n=e.get_xdo("*responsedescription");a&&e.state.set("action",a),["ACC","PRO","INC","SCH"].includes(t)||a&&"O"===a[0]?(n.xds.validate="required",n.xds.css="required"):(n.xds.validate="",n.xds.css=""),n.update()},createLearner:function(e){for(var t=["nsn","first","middle","last","birth"],a={},n=0;n<t.length;n++){var r=t[n];e.caller().state.get(r)&&(a[r]=e.caller().state.get(r))}var s=e.caller().get_xdo("*SchoolID");if(s){var o=e.caller().state.get("provider");(o=s.dd.valueMap[o])&&(o=o.display,a.provider=o)}a.xds=e.get_arg("xds")||"LSRCreateLearner",a.command="create",a.nodetype="1.5",e.newEvent("lightbox",a)},loadFeedReply:function(t){var a=e.links.pagenid().split("/")[0];t.newEvent("loadxds",{xds:t.get_arg("xds")||"LearningSupportAddAction",target:t.get_xdo("*reply").id(),nid:a,thread:e.gbl.nid,command:"create"})},editFeedResponse:function(e){e.newEvent("loadxds",{xds:e.get_arg("xds")||"LearningSupportAddAction",target:e.get_xdo("*reply").id(),nid:e.nid(),rid:e.rid()})},padValue:function(e){var t=e.state.get("nsn").padStart(10,"0");e.state.set("nsn",t)},saveParentConsent:function(t){var a=t.state.get("providers"),n=t.state.get("parentalConsentRecs");for(var r in a){var s=a[r];for(var o in n){var i=n[o];s.nid!=i.nid||s.pconsent==i.pcs&&s.pconsentby==i.pcsby||e.post({data:{pconsent:i.pcs,pconsentby:i.pcsby,rid:s.rid},url:{command:"putlink",nid:s.nid,xds:"LSRSetPConsent"}})}}}}}});

/* modules: capture */

"use strict";cf.module("capture",function(t,a,e){return{types:{tile:function(a){var e=a.state.get("ticket")||a.get_val("ticket"),c={h:t.gbl.host.replace(".edsby.com",""),c:a.state.get("captureClassNid")||a.data_full.nid,t:e,a:{c:"CaptureGatherPhoto",u:"CaptureUploader"}};!1!==e&&!1!==a.data&&""!=e||(c=!1),a.state.set("payload",c),a.data&&(a.data.qr=c),t.settings.dev&&(t.log.debug("capture.tile: Payload Length: ".concat(JSON.stringify(c).length)),t.log.debug("capture.tile: payload=".concat(JSON.stringify(c))))},expiry:function(t){if(t.data){var a=new Date((new Date).getTime()+1e3*t.data);t.data=a}}}}});

/* modules: carousel */

"use strict";cf.module("carousel",function(e,t,a,s){var n=!1,l=!1,r=function(e,t){var a=(t||e.data["carousel-selected"]||0)+1;a>=e.data["carousel-seatCount"]&&(a=0),e.set("carousel-selected",a)},o=function(e,t){var a=(t||e.data["carousel-selected"]||0)-1,s=e.data["carousel-seatCount"];a<0&&(a=s-1),e.set("carousel-selected",a)};return{types:{stateRelay:function(e){var t=(e.arg("dataKey")||"data").split("-");e.state.get(e.arg("stateKey")),e.state.watch(e.arg("stateKey"),function(a){for(var s={},n=s,l=0;l<t.length;l++){var r={};l==t.length-1&&(r=a),s[t[l]]=r,s=s[t[l]]}e.state.set(e.arg("relayKey"),n)})},stateUpdater:function(e){var t=e.state.get(e.arg("stateKey")),a=(e.arg("dataKey")||"data").split("-");if(t){for(var s={},n=s,l=0;l<a.length;l++){var r={};l==a.length-1&&(r=t),s[a[l]]=r,s=s[a[l]]}e.data=n}},ride:function(e){if(e.arg("stateKey")){var t=e.state.get(e.arg("stateKey")),a=e.arg("seatKey")||"seats";t?(e.data={},e.data[a]=t):e.data[a]?e.state.set(e.arg("stateKey"),e.data[a]):e.exitBlank()}},seat:function(e){e.get_index()!=(e.state.parent().data["carousel-selected"]||0)&&e.addStyle("display","none"),e.state.parent().watch("carousel-selected",e,function(t){e.get_index()==t?e.dom().fadeIn("fast"):e.dom().hide()}),n&&e.on("mousewheel",function(e){e.e.originalEvent.wheelDelta>0?r(e.state.parent(),e.get_index()):o(e.state.parent(),e.get_index()),e.stopPropagation(),e.preventDefault()})},crumb:function(e){(e.state.parent().data["carousel-selected"]||0)==e.get_index()?e.addClass("xds-carousel-crumb-selected"):e.removeClass("xds-carousel-crumb-selected"),e.on("click",function(e){e.state.parent().set("carousel-selected",e.get_index())}).inherit("fa.glyph")},crumbs:function(e){var a=e.data,s=!1;e.arg("stateKey")&&(a=e.state.get(e.arg("stateKey")));var c=e.state.get("carousel-selected")||0;if(a){for(var u=[],d=0;d<a.length;d++)a[d]._removed||u.push(a[d]);if(a=u,e.state.data["carousel-seatCount"]!=a.length){var i=c;0==a.length?i=0:c>=a.length&&(i=a.length-1),e.state.data["carousel-seatCount"]<a.length&&e.arg("selectAppend")&&(i=a.length-1),i!=c&&(s=i)}a.length&&(e.state.set("carousel-seatCount",a.length),e.state.watch("carousel-seatCount",function(){}),e.addClass("xds-carousel-crumbs-has"+a.length)),a.length<=1&&e.exitBlank(),e.data={crumb:a},e.addChild({xds:{id:"crumb",type:e.arg("crumbType")||"carousel.crumb",icon:"circle",fa_class:"fas",_styles:[{styles:{flex:"1","text-align":"center"}}]}})}else e.data=!1;!1!==s&&t.setTimeout(function(){e.state.set("carousel-selected",s)},10),n&&e.on("mousewheel",function(e){e.e.originalEvent.wheelDelta>0?r(e.state):o(e.state),e.stopPropagation(),e.preventDefault()}),l&&(e.arg("touchInherit","div"),e.inherit("touch.touchable").on("xds-touchable-swipe-right",function(e){o(e.state)}).on("xds-touchable-swipe-left",function(e){r(e.state)}))}},events:{next:function(e,t,a){e.state.set("carousel-seatCount",e.state.get("file").length),r(e.state)},previous:function(e,t,a){e.state.set("carousel-seatCount",e.state.get("file").length),o(e.state)}}}});

/* modules: charts */

"use strict";cf.module("charts",function(t,a,s,e){$.fn.svgAddClass=function(t){var a=this.attr("class");-1===a.indexOf(t)&&this.attr("class",a+" "+t)},$.fn.svgHasClass=function(t){return-1!==this.attr("class").indexOf(t)},$.fn.svgRemoveClass=function(t){var a=this.attr("class").replace(new RegExp("(\\s|^)"+t+"(\\s|$)","g"),"$2");this.attr("class",a)};var r={calcLinePath:function(t){for(var a=t.length,s=0,e=[];s<a;)isNaN(t[s][0])||isNaN(t[s][1])||e.push(t[s][0]+" "+t[s][1]),s++;return e.length?"M "+e.join(" L "):""},calcSplinePath:function(t,a){var s,e=t.length,i=0,n=[],h=(1-a)/2;if(t.length<3)return r.calcLinePath(t);for(s=t[0];i<e-1;){var o=[],d=[];0===i?(o.push(t[i]),o.push(t[i]),o.push(t[i+1]),o.push(t[i+2])):i==e-2?(o.push(t[i-1]),o.push(t[i]),o.push(t[i+1]),o.push(t[i+1])):(o.push(t[i-1]),o.push(t[i]),o.push(t[i+1]),o.push(t[i+2])),d.push(o[1]),d.push([(-h*o[0][0]+3*o[1][0]+h*o[2][0])/3,(-h*o[0][1]+3*o[1][1]+h*o[2][1])/3]),d.push([(h*o[1][0]+3*o[2][0]-h*o[3][0])/3,(h*o[1][1]+3*o[2][1]-h*o[3][1])/3]),d.push(o[2]),n.push(d[1][0]+" "+d[1][1]+" "+d[2][0]+" "+d[2][1]+" "+d[3][0]+" "+d[3][1]),i++}return n.length?"M "+s[0]+" "+s[1]+" C "+n.join(" C "):""},hslToRgb:function(t){var a,s,e,r=t[0]/360,i=t[1],n=t[2];if(0==i)a=s=e=n;else{var h=function(t,a,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(a-t)*s:s<.5?a:s<2/3?t+(a-t)*(2/3-s)*6:t},o=n<.5?n*(1+i):n+i-n*i,d=2*n-o;a=h(d,o,r+1/3),s=h(d,o,r),e=h(d,o,r-1/3)}return[Math.round(255*a),Math.round(255*s),Math.round(255*e)]},rgbToHsl:function(t){var a,s,e=t[0]/255,r=t[1]/255,i=t[2]/255,n=Math.max(e,r,i),h=Math.min(e,r,i),o=(n+h)/2;if(n==h)a=s=0;else{var d=n-h;switch(s=o>.5?d/(2-n-h):d/(n+h),n){case e:a=(r-i)/d+(r<i?6:0);break;case r:a=(i-e)/d+2;break;case i:a=(e-r)/d+4}a/=6}return[Math.round(360*a),s,o]},RGBToHexString:function(t){return"#"+(t[0]<16?"0":"")+parseInt(t[0]).toString(16)+(t[1]<16?"0":"")+parseInt(t[1]).toString(16)+(t[2]<16?"0":"")+parseInt(t[2]).toString(16)}},i=t.html.make,n=function(t,a){return i("g",t,"",a)},h=function(t,a,s,n,h){var o={fill:"none","stroke-width":"1px"};return $.extend(o,s),o.d=h===e?r.calcLinePath(t):r.calcSplinePath(t,h),o.d||(o.d="M 0 0 L 0 0"),o.class=a,i("path",n,o)},o=function(t,a,s,e){return h([t,a],s,e)},d=function(t,a,s,e){var r={x:t[0],y:t[1]};return $.extend(r,e),r.class=s,i("text",a,r)},l=function(a,s){var i=this,n=a;this.xdo=this.t=a;this.lines={},this.numlines=0,this.legendlines=0,this.s=$.extend({x:"linear",y:"linear",xmin:"data",xmax:"data",ymin:"data",ymax:"data",ylines:10,xlines:5,colourMode:"monochrome",padding:[20,5,15,15]},s),this.totalLines=(a.get_children()||[]).length;var h=this.s;h.width=parseInt(h.width,10)||n.get_setting("target").width(),h.height=h.height||n.get_setting("target").height();var d={};if(this.data=this.proc_data(),d.ymax=a.get_setting(n.cssPath+"-ymax"),d.ymin=this.findLimit("y","min",h.ymin),this.showYLabels=!+n.state.get("hideYLabels"),d.ymax===e&&(d.ymax=this.findLimit("y","max",h.ymax),!this.s.yFixedScale)){var l=this.findLimit("y","max","data");if(this.s.clipy&&this.s.clipy<l&&(l=this.s.clipy),l&&l>d.ymax){var c=(d.ymax-d.ymin)/h.ylines;h.ylines=Math.ceil((l-d.ymin)/c),d.ymax=c*h.ylines,h.ylines>h.height/12&&(h.ylines=h.height/12),a.addClass("xds-charts-dynamic-y")}}if((!l||l<d.ymax)&&a.addClass("xds-charts-static-y"),d.xmax=a.get_setting(n.cssPath+"-xmax")||this.findLimit("x","max",h.xmax),d.xmin=a.get_setting(n.cssPath+"-xmin")||this.findLimit("x","min",h.xmin),this.s.xLabel&&(this.s.padding[2]+=15),this.s.yLabel&&(this.s.padding[3]+=15),this.calc=d,this.calc.padding=h.padding,h.hover){var g,x=this.calcX(d.xmin),u=h.height-h.padding[2],f=h.padding[0];a.preclosetag(o([x,u],[x,f],"xds-charts-hover-line")),a.postclosetag('<table class="xds-charts-hover"></table>');var m=function(){(g=g||a.find(".xds-charts-hover-line")).show();var t=i.findX(),s=r.calcLinePath([[t,u],[t,f]]);g.attr("d",s),i.showHover(t,i.findClosest(t))};a.on("mouseenter",function(){a.on("mousemove",m)}),a.on("mouseout",function(){a&&!t.isHover(i.xdo.find(".xds-charts-hover"))&&(a.off("mousemove",m),i.hideHover(),(g||a.find(".xds-charts-hover-line")).fadeOut())})}};l.prototype={findX:function(){return t.memory.mousePosition.x-this.xdo.id(1).offset().left},findClosest:function(t){var a,s,r,i,n=this.data,h={};for(var o in n){for(r=e,s=(a=n[o].marker).length;s--;)r?Math.abs(a[s].__x-t)<i&&(i=Math.abs(a[s].__x-t),r=a[s]):(i=Math.abs(a[s].__x-t),r=a[s]);h[o]=r}return h},parseColour:function(t){if(t)return 0===t.indexOf("#")?[parseInt(t.substr(1,2),16),parseInt(t.substr(3,2),16),parseInt(t.substr(6,2),16)]:t.split(",").map(function(t){return parseInt(t,10)})},sanitizeColour:function(t,a){if(0===t)return"00";(t>255||t<0)&&(t=a);var s=t.toString(16);return 1==s.length?"0"+s:s},computeColours:function(t,a){var s,e=this,i={},n=[0,255,0];if(a)s=e.parseColour(a);else if("monochrome"===e.s.colourMode)n=[170,170,170],s=(s=e.parseColour(e.s.startingColour)||[255,0,0]).map(function(a,s){return t%2==1?Math.round(a+(1-t/e.totalLines)*(n[s]-a)):Math.round(a+t/e.totalLines*(n[s]-a))});else{var h=e.parseColour(e.s.startingColour),o=h?r.rgbToHsl(h):[0,1,.5];o[0]=Math.round(o[0]+t/e.totalLines*360+t%2*180)%360,o[1]=o[1]-o[1]/(1+Math.floor(t+.1)),o[2]=o[2]-o[2]/(1+Math.floor(t+.05)),s=r.hslToRgb(o)}for(var d in i.gradientEnd=s.map(function(t){return e.sanitizeColour(Math.round(t+.5*t),255)}),i.gradientStart=s.map(function(t){return e.sanitizeColour(Math.round(t+.05*t),255)}),i.marker=s.map(function(t){return e.sanitizeColour(Math.round(t-.05*t),0)}),s=s.map(function(t){return e.sanitizeColour(t,255)}),i.basic=s,i)i[d]="#"+i[d].join("");return i},hideActiveMarkers:function(){for(var t=$(".xds-charts-marker-active"),a=this.xdo&&t.length;a--;)t[a].classList&&t[a].classList.remove("xds-charts-marker-active"),$(t[a]).attr("r",0)},showHover:function(a,s){var e,r,i=this.xdo&&this.xdo.find(".xds-charts-hover"),n=[],h=t.html.tag;for(var o in this.hideActiveMarkers(),s)if(s[o]){!n.length&&this.s.xLabel&&s[o].x&&n.push(h("tr","xds-charts-hover-item",h("td","xds-charts-hover-name",this.s.xLabel)+h("td","xds-charts-hover-val",s[o].x))),e=this.lines[o],r=s[o].y,isNaN(parseFloat(r))||(r=parseFloat(r).toFixed(2));var d=$("#"+s[o].__path).find(".xds-charts-marker");d[0].classList&&d[0].classList.add("xds-charts-marker-active"),d.attr("r",5),n.push(h("tr","xds-charts-hover-item",h("td","xds-charts-hover-name",e.xds.name)+h("td","xds-charts-hover-val",r)))}var l=a;i.html(n.join("")),this.width()/2-a>0?i.removeClass("xds-charts-hover-right"):(l=a-i.outerWidth()-10,i.addClass("xds-charts-hover-right")),i.css({left:l+"px","margin-top":"-"+i.height()/2+"px"}),i.show()},hideHover:function(){var t=this.xdo&&this.xdo.find(".xds-charts-hover");t&&t.fadeOut(),this.hideActiveMarkers()},height:function(){return this.s.height},width:function(){return this.s.width},chartHeight:function(){return this.s.height-this.calc.padding[0]-this.calc.padding[2]},chartWidth:function(){return this.s.width-this.calc.padding[1]-this.calc.padding[3]},grid:function(){var t,a="",s=this.chartHeight(),e=this.chartWidth(),r=this.s.ylines,i=s/r,h=this.calc.padding[0],d=this.calc.padding[3],l=this.s.gridLineWidth||1,c=r;do{a+=o([d,t=(r-c)*i+h-l],[e+d,t],["xds-charts-grid","xds-charts-grid-"+c])}while(c--);return a=n(a,"xds-charts-grid")},yAxis:function(){var t,a,s="",e=this.chartHeight(),r=this.s.ylines,i=e/r,h=this.calc.padding[3],o=this.calc.padding[0],l=(this.calc.ymax-this.calc.ymin)/r,c=this.s.axisFontSize||15,g="right"===this.s.yLabelAlignment?"end":"start",x=this.s.yLabelOffset||0,u={"font-size":c,"text-anchor":g},f=r;if(this.showYLabels)do{t=(r-f)*i+o+c-2,(a=(a=l*f)<1&&a>0?a.toFixed(2):Math.round(a))>1e9&&(a=a.toPrecision(2)),s+=d([h+x,t],a+"",["xds-charts-axis-label","xds-charts-axis-label-y-"+f],u)}while(f--);return this.s.yLabel&&(s+=d([-this.height()/2,this.calc.padding[3]-c],this.s.yLabel,"xds-charts-label-y",{transform:"rotate(-90)"})),s=n(s,"xds-charts-yaxis")},xAxis:function(){var a,s=this.s.axisFontSize||11,e=this.s.xAxisOffset||0,r=this.s.x,i=this.chartWidth(),h=this.calc.xmin,o=this.calc.xmax,l=this.s.xlines,c=Math.round((o-h)/864e5)+1,g=(o-h)/l,x=(i-e)/l,u=l,f="",m=this.calc.padding[3],p=this.calc.padding[0],v=this.chartHeight(),y={"font-size":s};do{y["text-anchor"]=u===l?"end":0===u?"start":"middle",a="date"===r?u<c?t.dateFormat(new Date(h+g*u),this.s.xAxisFormat||"mmm. d, yyyy"):"":"time"===r?t.dateFormat(new Date(h+g*u),this.s.xAxisFormat||"mmm. d, yyyy"):u,f+=d([u*x+m+e,p+v+s],a,["xds-charts-axis-label","xds-charts-axis-label-x-"+u],y)}while(u--);return this.s.xLabel&&(f+=d([this.width()/2-20,p+v+2.5*s],this.s.xLabel,"xds-charts-label-x")),n(f,"xds-charts-xaxis")},calcY:function(t){var a=this.calc.ymin,s=this.calc.ymax,e=this.chartHeight()/(s-a>0?s-a:1);return this.calc.padding[0]+(s-t)*e},calcX:function(t){var a=this.s.xAxisOffset||0,s=this.calc.xmin,e=this.calc.xmax,r=this.calc.padding,i=(this.chartWidth()-r[2]-13-a)/(e-s>0?e-s:1);return r[3]+15+a+(t-s)*i},line:function(t){this.numlines++;var a=t.xds.id;if(!this.data[a])return!1;var s,r,o=this,l=o.data[a].marker,c=l.length,g=0,x=[],u=o.computeColours(o.numlines,t.arg("color"));if(!o.s.noLegend&&t.arg("name")&&(!t.arg("defaultHidden")||t.get_setting("charts-show")&&t.get_setting("charts-show")[a])&&(o.xdo.preclosetag(d([o.s.width-100,o.s.padding[2]+12*o.legendlines],t.arg("name"),["xds-legend","xds-legend-line-"+o.numlines],{fill:u.basic})),o.legendlines++),t.arg("horizontal")){var f=this.chartWidth(),m=this.calc.padding[3];r=c?this.calcY(l[0].y):this.calcY(l.y),x.push([m,r]),x.push([m+f,r])}else for(;g<c;)s=l[g]._x!==e?l[g]._x:l[g].x,r=l[g]._y!==e?l[g]._y:l[g].y,s!==e&&r!==e&&(s=l[g].__x=this.calcX(s),r=l[g].__y=this.calcY(r),x.push([s,r])),g++;var p;if(t.arg("fill")){var v=i("stop","",{offset:"0%","stop-color":u.gradientStart},["xds-charts-gra-start-"+o.numlines]),y=i("stop","",{offset:"100%","stop-color":u.gradientEnd},["xds-charts-gra-end-"+o.numlines]),_=i("linearGradient",v+y,{id:"xds-charts-grad-"+o.numlines,x1:"0%",y1:"0%",x2:"0%",y2:"100%"});o.xdo.preclosetag(_),x[0]&&(x.unshift([x[0][0],this.calcY(0)]),x.push([x[x.length-1][0],this.calcY(0)])),p="url(#xds-charts-grad-"+o.numlines+")"}o.lines[t.xds.id]=t,t.temp.colors=u;var b={fill:p,stroke:u.basic};return t.arg("lineWidth")&&(b["stroke-width"]=t.arg("lineWidth")+"px"),n(h(x,["xds-charts-line"],b,"",t.arg("tension")),["xds-charts-line-group"])},marker:function(a,s,n){var h=n.xds.radius||0;t.is_str(h)&&"func:"===h.substr(0,5)&&(h=t.get_func(h.substr(5))(n));var o=(a=this.data[a].marker)[s];if(o.__path=n.path,o.__x===e||o.__y===e)return!1;var d=n.arg("stroke");d&&(d=r.RGBToHexString(d.split(",")));var l=n.arg("markerText")?n.arg("markerText"):"";if(l)return i("text",l,{x:o.__x,y:o.__y+6,"text-anchor":"middle"},["xds-charts-marker"]);var c=n.parent_xdo().temp.colors.marker,g={cx:o.__x,cy:o.__y,r:h,fill:c,style:""};return d&&(g.style=g.style+"stroke:"+d+";"),i("circle",l,g,["xds-charts-marker"])},boxMarker:function(t,a,s){var r="",n=(t=this.data[t].marker)[a];if(n.__path=s.path,n.__x===e||n.__y===e)return!1;var h=s.arg("markerText")?s.arg("markerText"):"",o={x:n.__x-6,y:n.__y-4,width:12,height:12,rx:2,ry:2,fill:"#FFFFFF","stroke-width":2,stroke:"#206FB2"};return r+=i("rect",h,o,["xds-charts-boxMarker"]),h&&(r+=i("text",h,{x:n.__x,y:n.__y+6,"text-anchor":"middle"},["xds-charts-boxMarker"])),r},legend:function(t){var a,s,e,r,h=this,o=h.xdo.get_setting("charts-show"),d=h.s.padding[2],l=h.s.width-108,c=0;for(var g in h.lines)(g=h.lines[g]).arg("name")&&(!g.arg("defaultHidden")||o&&o[g.arg("id")])&&(t.addChild({id:g.arg("id"),type:"charts.types.legendItem",name:g.arg("name"),color:g.temp.colors.basic,index:c,leftBoxMargin:l,topBoxMargin:d}),c++);return 0===c?"":n((s=["xds-charts-legendBox"],e={height:12.8*(c+2),width:106,fill:"#ffffff",stroke:"#000000"},r={x:(a=[l,d])[0],y:a[1]},$.extend(r,e),r.class=s,i("rect","",r)))},legendItem:function(t){var a=i("circle",t.arg("id"),{cx:t.arg("leftBoxMargin")+8,cy:t.arg("topBoxMargin")+14*t.arg("index")+14,r:4,fill:t.arg("color")});return a+=d([t.arg("leftBoxMargin")+18,t.arg("topBoxMargin")+14*t.arg("index")+18],t.arg("name"),[],{fill:t.arg("color")}),n(a,["xds-legend","xds-legend-line","xds-legend-line-"+t.arg("id")])},proc_data:function(){for(var a,s,e,r=this.xdo,i=r.get_children(),n=r.get_val(),h=i.length,o={};h--;)t.is_obj(n[i[h].id])&&(o[i[h].id]=n[i[h].id]);if("date"===this.s.x||"time"===this.s.x)for(s in o){for(a=s,s=o[s].marker,t.is_obj(s)&&(s=t.obj_to_arr(s)),h=s.length;h--;)0!==s[h].x&&(s[h]._x=new Date(t.parseDate(s[h].x)).getTime());o[a].marker=t.sort({sortBy:"_x"},s)}else if("even"===this.s.x)for(s in o)for(s=o[s].marker,t.is_obj(s)&&(s=t.obj_to_arr(s)),h=s.length,e=0;e<h;)s[e]._x=e,e++;return o},findLimit:function(t,a,s){var r=this.xdo,i=r.get_setting("charts-show")||{};if("data"===s){s=this.s[t];var n,h,o,d=this.data,l=t;for(var c in"date"!==s&&"time"!==s&&"even"!==s||(l="_"+l),d)if(h=(o=d[c].marker).length){if(r.xds.fields[c]&&r.xds.fields[c].defaultHidden&&!i[c])continue;for(;h--;)n="max"==a?o[h][l]>n||n===e?o[h][l]:n:o[h][l]<n||n===e?o[h][l]:n}return n}return s}};var c={charts:{},onclean:function(t){var a=c.charts[t.path];if(a){for(var s in a)delete a[s];delete t.chart,delete c.charts[t.path],t.deleteGlobal("xds-charts-chart")}},types:{chart:function(a){if(s.createElementNS&&s.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect){var e={x:a.arg("xaxis"),y:a.arg("yaxis"),xmin:a.arg("xmin"),xmax:a.arg("xmax"),ymin:a.arg("ymin"),ymax:a.arg("ymax"),yFixedScale:a.arg("yFixedScale"),width:parseInt(a.arg("width")),height:a.get_setting("height")?parseInt(a.get_setting("height")):parseInt(a.arg("height")),ylines:a.arg("ylines"),xlines:a.arg("xlines"),padding:a.arg("padding"),xAxisFormat:a.arg("xAxisFormat"),xLabel:a.arg("xLabel"),yLabel:a.arg("yLabel"),noLegend:a.arg("noLegend"),hover:a.arg("hover"),zoom:a.arg("zoom"),drag:a.arg("drag"),colourMode:a.arg("colourMode"),startingColour:a.arg("startingColour"),yLabelAlignment:a.arg("yLabelAlignment"),yLabelOffset:a.arg("yLabelOffset"),xAxisOffset:a.arg("xAxisOffset"),clipy:a.arg("clipy")},r=new l(a,e);this.chart=c.charts[this.path]=r,a.arg("wrap","div"),a.arg("wrapCSS","xds-charts-wrap"),a.tag("svg").addAttr({height:r.height()+"px",width:r.width()+"px"}),a.posttag(r.grid()+r.yAxis()+r.xAxis()),a.global("xds-charts-chart",r),a.onclean(c.onclean)}else a.xds.title=t.lang("Sorry, your browser does not support charting."),a.inherit("noContent").exit()},line:function(t){t.tag("g");var a=t.global("xds-charts-chart");t.posttag(a.line(t)),t.addClass("xds-charts-line-"+a.numlines),t.posttag('<g class="xds-charts-line-markers">'),t.preclosetag("</g>"),t.arg("hiddenLine")&&t.addClass("xds-charts-line-hidden");var s=t.get_setting("charts-show")||{};if(t.arg("defaultHidden")&&!s[t.xds.id])return!1;t.arg("name")&&(t.on("mouseover",function(t,a,s){var e=t.get_xdo("*legend-"+t.arg("id"));e&&e.dom().svgAddClass("xds-charts-legend-line-selected")}),t.on("mouseout",function(t,a,s){var e=t.get_xdo("*legend-"+t.arg("id"));e&&e.dom().svgRemoveClass("xds-charts-legend-line-selected")})),t.global("xds-charts-line",t.xds.id)},smoothLine:function(t){t.inherit("charts.types.line",{tension:t.arg("tension")===e?.6:t.arg("tension")})},horizontalLine:function(t){t.inherit("charts.types.line",{horizontal:!0})},scatter:function(t){t.arg("hiddenLine",!0),t.inherit("charts.types.line")},marker:function(t){var a=t.global("xds-charts-chart");t.tag("g").posttag(a.marker(t.global("xds-charts-line"),t.get_index(),t)),t.sparse=!0},boxMarker:function(t){var a=t.global("xds-charts-chart");t.tag("g").posttag(a.boxMarker(t.global("xds-charts-line"),t.get_index(),t)),t.sparse=!0},legend:function(t){var a=t.global("xds-charts-chart");t.tag("g").posttag(a.legend(t)),t.sparse=!0},legendItem:function(t){var a=t.global("xds-charts-chart");t.tag("g").posttag(a.legendItem(t)),t.sparse=!0,t.on("mouseover",function(t,a,s){t.parent_xdo().get_xdo("sibling:"+t.arg("id")).dom().svgAddClass("xds-charts-line-hovered")}),t.on("mouseout",function(t,a,s){t.parent_xdo().get_xdo("sibling:"+t.arg("id")).dom().svgRemoveClass("xds-charts-line-hovered")})}},events:{toggle:function(t,a){var s=t.target().xdo,e=s.get_setting("charts-show")||{};t.get_arg("line").split(",").map(function(t){e[t]?delete e[t]:e[t]=1}),s.event("redraw",{"charts-show":e,redrawPath:s.path_include||s.cssPath})}}};return c});

/* modules: zooms */

"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var r=[],a=!0,s=!1,o=void 0;try{for(var n,i=e[Symbol.iterator]();!(a=(n=i.next()).done)&&(r.push(n.value),!t||r.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{a||null==i.return||i.return()}finally{if(s)throw o}}return r}function _arrayWithHoles(e){if(Array.isArray(e))return e}cf.module("zooms",function(e,t,r,a){function s(e,r,s){var o,n,i,d=t.location.search||"";try{o=e.build.urlparams[s?1:0]}catch(e){o=a}if(o===a){if(s)try{d=e.build.hash}catch(e){}for(n=d.split("?").slice(1).join("?").split("&"),e.build.urlparams||(e.build.urlparams=[]),o=e.build.urlparams[s?1:0]={};n.length;)""!==(i=n.pop().split("="))[0]&&(o[decodeURIComponent(i[0])]=i.length>=2?decodeURIComponent(i.slice(1).join("=")):a)}return r!==a?o[r]:o}function o(t,r){var a,s,o=t.parent.data||{},n=t.arg("excode"),i=t.arg("data"),d=t.arg("attcode")||"astatus",l=t.arg("reason")||"reasontag",c=!1,g=!1;n?-1!==n.indexOf("-")&&(d=n.split("-"),c=!0):-1!==d.indexOf("-")&&(d=d.split("-"),c=!0),-1!==l.indexOf("-")&&(l=l.split("-"),g=!0);for(var p=Object.values(o),u=0;u<p.length;u++){var f=p[u];a=c?e.search(d,f):f[d],n&&(a=3===a?1:3),(s=r(a,g?e.search(l,f):f[l],t.arg("format1")))&&(f["_"+i]=s)}t.inherit("facets.simpleFacet")}var n={types:{attendanceCode:function(t){var r,s,o;-1===["",!1,a].indexOf(t.get_val())&&(s="none"!==(o=t.arg("reason")||"reasontag")?"state"===(o=o.split(":"))[0]&&o.length>1?t.state.get(o.pop()):t.get_val(o.pop(),o.pop()||"siblings"):a,r=e.get_module("attendance_public").code_string(t.get_val(),s,t.arg("shortForm"))),r&&(t.displayVal=r),t.inherit(t.arg("ttag")||"zooms.types.tag")},attendanceCodeFacet:function(t){o(t,e.get_module("attendance_public").code_string)},attendanceReason:function(t){var r,a=t.arg("excode"),s=a&&parseInt(t.get_val(a,"siblings"),10),o=parseInt(t.get_val(t.arg("attcode")||"astatus","siblings"),10),n=t.get_val();n?(!o&&s&&(o=3===s?1:3),r="UNK"!==n.split("-").pop()&&e.get_module("attendance_public").reason_string(o,n)):t.arg("titleNoneLate")&&1===o?r=t.arg("titleNoneLate"):t.arg("titleNoneAbsent")&&o&&0!==o&&1!==o&&(r=t.arg("titleNoneAbsent")),r||!1===r?!1===r&&(t.data=""):r=n,r&&(t.arg("noParens")?t.displayVal=r:t.displayVal=" ("+r+")"),t.inherit(t.arg("ttag")||"zooms.types.tag")},attendanceReasonFacet:function(t){o(t,e.get_module("attendance_public").reason_string)},attendanceSheetFacet:function(t){var r,s,o=t.parent.data||{},n=t.arg("data"),i=t.arg("adhoc")||"adhoc",d=t.arg("meetingtype")||"meeting_type",l=t.arg("period")||"when-sheet-period-pname",c=t.arg("mname")||"when-sheet-extra-title",g=t.arg("titleAdHoc")||e.lang("Extra"),p=!1,u=!1,f=!1;-1!==i.indexOf("-")&&(i=i.split("-"),u=!0),-1!==l.indexOf("-")&&(l=l.split("-"),p=!0),-1!==c.indexOf("-")&&(c=c.split("-"),f=!0);for(var m=Object.values(o),h=0;h<m.length;h++){var v=m[h];(r=u?e.search(i,v):v[i])===a&&(r=2===((u?e.search(d,v):v[d])||0)),r?(s=f?e.search(c,v):v[c])&&(s=[g,s].join(" ")):s=p?e.search(l,v):v[l],s&&(v["_"+n]=s)}t.inherit("facets.simpleFacet")},column:function(e){var t=[];e.arg("itag")?(t.push((e.path_include||e.cssPath)+"-wrap"),e.proxyCSS&&t.push(e.proxyCSS+"-wrap"),e.wrapCSS&&t.push(e.wrapCSS),e.xds.wrapCSS&&t.push(e.xds.wrapCSS),e.xds.align&&t.push("xds-colalign-"+e.xds.align),e.arg("recspan")&&t.push("xds-recspan"),e.pretag('<td class="'+t.join(" ")+'"'+(e.arg("recspan")?' rowspan="2"':"")+">"),e.postclosetag("</td>"),e.inherit(e.arg("itag"))):(e.tag("td"),e.arg("recspan")&&(e.addAttr("rowspan",2),e.addClass("xds-recspan")),e.arg("align")&&e.addClass("xds-colalign-"+e.arg("align")))},facet:function(e){e.on("xds-facet","zooms.events.facet"),e.inherit("facets.facet")},gearCol:function(t){t.tag("div"),t.rnode._gearselect&&t.addClass("checked"),t.posttag('<a class="xds-zooms-types-gearCol-link">'+e.html.div("",["xds-zooms-types-gearCol-inner","xds-form-sprite"])+"</a>")},gearModeButton:function(t){t.on("click",e.get_func("zooms.events.toggleGearMode")),t.addAttr("aria-label",e.lang("Toggle item selection mode")),t.sparse=!0,t.addChild({xds:{id:"icon",type:"icon",icon:"gear",css:"xds-gearbutton-icon"}}),t.inherit("button")},name:function(e){var t=n.funcs.isPicker(e);t&&e.arg("bindif")&&(t=e.pre.showif(e,e.xds,!0)),e.inherit(t?"name":"div")},phone:function(e){if(!e.data)return!1;e.xds.wrap="li",e.xds.title&&e.pretag('<span class="xds-zooms-types-phone-label">'+e.xds.title+"</span>"),e.showTitle=!1,e.tag("span")},record:function(){function t(t){var r,a,s,o,n=t;if((t=t.parents("tbody"))&&t.length&&(t.fadeOut(function(){$(this).remove()}),(r=$(t.parents(".xds-zooms-types-table")))&&r.length&&r.xdo&&(a=(r=r.xdo).findChildType(r.arg("rowType")).id,r.data[a].splice(n.get_index(),1),s=e.memory.slices[n.build.hash]))){for(s=JSON.parse(s),o=r.path.split("-").slice(1).reverse(),r=s.slices[0].data;o.length;)if(!(r=r[o.pop()]))return;delete r[a]["r"+n.rnode.rid],e.memory.slices[n.build.hash]=JSON.stringify(s)}}function r(e,t,r){return e._notbodyopen||(t=t.parent()),!(!t||!t.length)&&(t[0].outerHTML=r,!0)}return function(a){a.removehook=t,a.updatehook=r,a.addClass("xds-zoom-row-r"+a.rnode.rid),a.map(),e.layout.isPhone()||function(e){var t=["xds-zoomtable-body",e.cssPath];e.xds._rowCount||(e.xds._rowCount=0),++e.xds._rowCount%2&&e.addClass("xds-zooms-types-table-oddrow"),e.tbodyCSS&&t.push(e.tbodyCSS),e.xds.tbodyCSS&&t.push(e.xds.tbodyCSS),e._notbodyopen||e.pretag('<tbody class="'+t.join(" ")+'">'),e._notbodyclose||e.postclosetag("</tbody>"),e.inherit("simpleTableRow")}(a)}}(),selectedFacet:function(e){e.arg("facets",[["1",e.arg("titleSelected"),1]]),e.arg("facetkeys",{1:"1"}),e.arg("empty",1),e.inherit("facets.buttonFacet")},table:function(){function t(e){var t=this.data_full.nid+"-"+this.xds_full.id+"-"+this.cssPath;return this.temp.params?t+="-"+this.temp.params:this.get_setting("params")&&(t+="-"+this.get_setting("params")),e&&(t+="/"+e),t}function r(t){var r=$($(t.target).parents(".xds-zooms-types-table"));e.get_func("zooms.events.gearTitleClick")(r.xdo,r)}function o(t,a){t=(a=a.parents(".xds-simpleTable")).xdo;var s,o=a.find(".xds-zooms-types-gearCol-title"),n=t.findChildType(t.arg("rowType"));o.on("click",r),s=t.data[n.id]||{},t.temp.nVisible=t.temp.nVisSelected=0;for(var i=Object.values(s),d=0;d<i.length;d++){var l=i[d];++t.temp.nVisible,l._gearselect&&++t.temp.nVisSelected}t.temp.nVisible&&t.temp.nVisible===t.temp.nVisSelected&&o.addClass("checked"),t.trigger("xds-zoom-selection-changed",{gearmode:t.temp.gearmode,nSelected:t.temp.nSelected,selection:e.storage(t.getGearStoragePath("selected"))||-1})}function i(t){t.posttag(e.html.div("",["xds-zooms-types-gearCol-title xds-form-sprite"])),t.addAttr("aria-label",e.lang("Select all items")),t.ready(o)}function d(e){e.trigger("xds-zoom-selection-changed",{gearmode:!1,nSelected:0,selection:-1})}function l(t,r){var a,s,o,n,i=this.pages(),d=this.id(1),l=e.storage(this.getGearStoragePath("selected"));for(a=i.length;a>0;)for(s=(o=i[--a]).length;s>0;)n=o[--s],t&&!n._gearselect?(n._gearselect=!0,++this.temp.nSelected,l||(l={}),l["r"+n.rid]=n.nid,this.temp.selrecs||(this.temp.selrecs={}),this.temp.selrecs["r"+n.rid]=n):!t&&n._gearselect&&(delete n._gearselect,--this.temp.nSelected,delete l["r"+n.rid],delete this.temp.selrecs["r"+n.rid]);this.temp.nVisSelected=t?this.temp.nVisible:0,d.find(".xds-zooms-types-gearCol")[t?"addClass":"removeClass"]("checked"),d.find(".xds-zooms-types-gearCol-title")[t?"addClass":"removeClass"]("checked"),0===this.temp.nSelected&&(l=-1,this.temp.selrecs&&delete this.temp.selrecs),e.storage(this.getGearStoragePath("selected"),l),r||this.trigger("xds-zoom-selection-changed",{gearmode:this.temp.gearmode,nSelected:this.temp.nSelected,selection:l})}function c(){this.setAllSelected(!1,!0),this.temp.nSelected=0,this.temp.selrecs&&delete this.temp.selrecs,e.storage(this.getGearStoragePath("selected"),-1),this.trigger("xds-zoom-selection-changed",{gearmode:this.temp.gearmode,nSelected:0,selected:-1})}function g(t,r){t===a&&(t=!0),e.storage(this.getGearStoragePath("enabled"),t?1:-1),r||e.get_func("redraw")(this)}function p(e){var t,r,a,s,o={nids:[],rids:[],recs:[]},n=o.recs,i=o.nids,d=o.rids;for(s=(a=this.pages()).length;s--;)for(r=(t=a[s]).length;r--;)e&&!e(t[r])||(n.push(t[r]),i.push(t[r].nid),d.push(t[r].rid));return n.reverse(),i.reverse(),d.reverse(),n._r=i._r=d._r=!1,o}function u(t){var r,a,s={nids:[],rids:[],recs:[]},o=s.recs,i=s.nids,d=s.rids;if(!this.temp.gearmode&&!n.funcs.isPicker(this,!0))return this.getRecords();if(this.temp.nSelected){r=e.storage(this.getGearStoragePath("selected")),a=this.temp.selrecs;for(var l=Object.entries(r),c=0;c<l.length;c++){var g=_slicedToArray(l[c],2),p=g[0],u=g[1];t&&!t(u)||(o.push(a[p]),i.push(u),d.push(a[p].rid))}}return o._r=i._r=d._r=!1,s}function f(e){var t,r,s,o={nids:[],rids:[],recs:[]},n=o.recs,i=o.nids,d=o.rids;try{t=this.data[this.temp.row.id]}catch(e){t=[]}for(s=0;s<t.length;s++)if((r=t[s])!==a){if(e&&!e(r))continue;n.push(r),i.push(r.nid),d.push(r.rid)}return o}function m(e,t,r){t.find(".xds-zooms-types-gearCol-title")[e.temp.nVisible&&e.temp.nVisSelected===e.temp.nVisible?"addClass":"removeClass"]("checked")}function h(){var e=this.get_setting();return e.filter!==a||e.filterServer||e.filterGlobal!==a&&!1!==e.filterGlobal||this.temp.gearmode||n.funcs.isPicker(this,!0)}function v(){if(this.isFiltered())return this.getSelectedRecords()}function _(e,t,r){if((e._deferred_loaded||1)<t){if(r){if((r[e.rid]||0)>=t)return!1;r[e.rid]=t}return!0}return!1}function b(t,r){var o,n=t.temp.deferred_stage||t.arg("deferred_stage")||2,i=e.gen_url({xds:t.xds_full.id,nid:t.build.hash.split("?")[0].split("/").pop(),stage:n,_method:"GET"}),d=s(t,"profile",!0);return r===a&&(t.temp.deferred_load_in_progress||(t.temp.deferred_load_in_progress={}),o=t.temp.deferred_load_in_progress,r=t.getVisibleRecords(function(e){return _(e,n,o)}).rids),d&&(i+="&profile="+d),r.length?e.post({url:i,data:{select_records:r.join(",")}},!0).then(function(r){return function(t,r,s){var o,n,i,d,l,c,g,p,u,f,m=!1,h=0,v=0;if(!t.build||t.temp.dead){if(!(i=$("."+t.fixPath).xdo))return;t=i}o=t.build.stage_loaded[t.path]+1,(n=S(t))._deferred_loaded=o;try{for(d=r.slices[0].data.deferred,g=JSON.parse(e.memory.slices[t.build.hash]),p=g.slices[0].data,u=t.path.split("-").slice(1).reverse();u.length&&p!==a&&!1!==p;)p=p[u.pop()];p&&(m=p[t.temp.row.id])}catch(e){d={}}for(var _=Object.entries(d),b=0;b<_.length;b++){var x=_slicedToArray(_[b],2),y=x[0],C=x[1];f=Object.assign(Object.assign({},n),C),m&&m[y]?(Object.assign(m[y],f),++h):++v,s&&s[C.rid]&&delete s[C.rid],(c=t.find(".xds-zoom-row-"+y).xdo)&&(c.map(f),c.update())}if(s)for(var w=Object.keys(s),k=0;k<w.length;k++){var z=w[k];m&&(l=m["r"+z])&&(l._deferred_loaded=Math.max(l._deferred_loaded||0,o)),delete s[z]}return t.build.stage_loaded[t.path]=o,e.memory.slices[t.build.hash]=JSON.stringify(g),t.state.set("deferred_loaded",t.build.stage_loaded[t.path]),{loaded:h,extra:v,records:d,template:n}}(t,r,o)}):Promise.resolve({loaded:0,extra:0,records:[]})}function x(e,t,r){e.hasDeferred()&&b(e).then(function(t){t&&t.loaded>0&&e.trigger("xds-zoom-deferred-records-loaded")})}function y(e,t,r){if(e.hasDeferred())return new Promise(function(t,r){b(e,e.getRecords(function(e){return _(e,2)}).rids).then(function(r){return function(e,t,r){for(var a,s=e.getRecords().recs,o=t.records,n=Object.values(s),i=0;i<n.length;i++){var d=n[i];(a=o["r"+d.rid])&&Object.assign(d,Object.assign(Object.assign({},t.template),a))}r(t)}(e,r,t)}).catch(r)})}function S(e){var t,r,s,o=e.xds_full.fields.deferred;if(!(t=e.temp.deferred_keys))for(t=e.temp.deferred_keys={},r=o&&o.fields?Object.keys(o.fields):[],s=0;s<r.length;s++)t[r[s]]=a;return t}function C(){return!!Object.keys(S(this)).length}function w(e,t,r){var a,s,o=r["data-sortby"],n=S(e),i=!1;for(e.e.stopImmediatePropagation(),e.e.preventDefault(),o=o?o.split(","):[];o.length;){for(a=o.pop().split("-").reverse(),s=e.temp.row;a.length;){if(!(s=s.fields[a.pop()])){i=!0;break}if(s.cdid&&n.hasOwnProperty(s.cdid)){i=!0;break}}if(i)break}i?y(e).then(function(){e.event("tables.events.colClicked",r)}):e.event("tables.events.colClicked")}var k=function(r){var s,o,_,b;if(r.fixPath=r.proxyCSS||r.cssPath,r.getSelectedRecords=u,r.getGearStoragePath=t,r.setGearMode=g,r.setAllSelected=l,r.clearAllSelected=c,r.isFiltered=h,r.getFilteredRecords=v,r.getVisibleRecords=f,r.getRecords=p,r.hasDeferred=C,r.loadAllDeferred=y,r.arg("rowType")||(r.xds.rowType="zooms.types.record"),r.arg("ignoreTypes")||(r.xds.ignoreTypes="zooms.types.tag"),r.arg("colTypes")||(r.xds.colTypes="zooms.types.column"),r.arg("ignoreFlags")||(r.xds.ignoreFlags="tableTagField"),r.temp.row=r.findChildType(r.arg("rowType")),(s=r.arg("gearMode"))===a&&n.funcs.isPicker(r,!1)&&(s=!0),s===a&&(s=(s=e.storage(r.getGearStoragePath("enabled")))&&-1!==s),r.temp.gearmode=s||!1,r.temp.nSelected=r.temp.nVisible=r.temp.nVisSelected=0,r.temp.gearmode){if(o=e.storage(r.getGearStoragePath("selected"))){b=!1,_=r.data[r.temp.row.id];for(var S=Object.keys(o),k=0;k<S.length;k++){var z=S[k];_&&_[z]?(_[z]._gearselect=!0,r.temp.selrecs||(r.temp.selrecs={}),r.temp.selrecs[z]=_[z],++r.temp.nSelected):(delete o[z],b=!0)}b&&e.storage(r.getGearStoragePath("selected"),r.temp.nSelected?o:-1)}r.on("xds-zoom-selection-changed",m)}else r.ready(d);r.arg("deferred")&&(r.build.stage_loaded||(r.build.stage_loaded={}),r.build.stage_loaded[r.path]||(r.build.stage_loaded[r.path]=1),r.ready(x),r.on("xds-table-page-advanced",x)),e.layout.isPhone()?function(e){var t=e.temp.row,r=e.arg("ignoreTypes").split(",");e.ignoreTypes={sys:!0};var s=!0,o=!1,n=a;try{for(var i,d=r.values()[Symbol.iterator]();!(s=(i=d.next()).done);s=!0){var l=i.value;e.ignoreTypes[l]=!0}}catch(e){o=!0,n=e}finally{try{s||null==d.return||d.return()}finally{if(o)throw n}}for(var c=Object.values(t.fields),g=0;g<c.length;g++){var p=c[g];e.ignoreTypes[p.type]||p.showif&&!1===e.pre.showif(e,p)||(p.phoneKeyCol?(p.css=(p.css?p.css+" ":"")+"xds-zooms-types-table-phone-keycol",p.showTitle=!1):p.title&&(":"!==p.title.charAt(p.title.length-1)&&(p.title+=":"),p.wrapTitle=!0))}e.tag("div")}(r):function(t){var r,a,s,o=t.temp.row,n=0,d=!1,l=0;if(t.xds.notbody=!0,t.temp.gearmode&&!o.fields._GEAR){s={align:"center",events:[{func:"zooms.events.gearClick",trigger:"click",args:{label:e.lang("Select Item"),stopPropagation:!0}}],id:"_GEAR",itag:"zooms.types.gearCol",noSorting:!0,width:"50px",recspan:!0,showTitle:!0,titlefunc:i,type:"zooms.types.column"},o._children.splice(0,0,s);for(var c=Object.entries(o._children),g=0;g<c.length;g++){var p=_slicedToArray(c[g],2),u=p[0];p[1]._i=parseInt(u,10)}o.fields._GEAR=s}for(r in t.inherit("simpleTable"),t.off("xds-sortcol-clicked"),t.delegate("xds-sortcol-clicked",w),o.fields)o.fields.hasOwnProperty(r)&&(a=o.fields[r],!t.temp.cols[a.id]||a.showif&&!1===t.pre.showif(t,a)||(a.rowspan||a.recspan?d?(d=!1,l|=2):l|=1:0===n||d?(n+=parseInt(a.colspan||1,10),d=!0):a.rowspan=2));o._recTagColspan=n,o._recTagBorders=l}(r)};return k.getSelectedRecords=function(e){return e.getSelectedRecords()},k.getFilteredRecords=function(e){return e.getFilteredRecords()},k.getRecords=function(e){return e.getRecords()},k}(),tag:function(){var t=function e(t){var r=e.setupTagRow(t),a=!(t.sparse&&!t.temp.border_tag)&&(t.xds.dbid||t.xds.cdid||t.temp.border_tag)&&!t.data;if(!r&&a)return!1;a||"nowrap"===t.arg("ttag")?(t.displayVal=(t._tag.pre||"")+(t.data||"")+(t._tag.postclose||""),t.inherit("nowrap")):t.inherit(t.arg("ttag")||"block")};function r(e,t){var r,s,o,n=t.parents(".xds-tagrow");n.length?s=n.prev():n=(s=$("#"+e.get_parent())).next(),r=s.parent(),s.hasClass("xds-has-click")&&(n.addClass("xds-has-click"),(o=s.attr("tabindex"))!==a&&(s.removeAttr("tabindex"),r.attr("tabindex",o))),n.bind("click mousedown mouseup",function(e){s.trigger(e.type,e)}),r.bind("click mousedown mouseup",function(e,t){t&&t.zoom_forward||e.target!==e.currentTarget||(e.zoom_forward=!0,s.trigger(e.type,e),e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault())})}return t.setupTagRow=function(t){var a=t.prev(),s=t.next(),o=["xds-tagrow"],n=!1;return a&&("zooms.types.tag"===a.type||a.tableTagField)||(t.arg("tagRowCSS")&&o.push(t.arg("tagRowCSS")),t.parent._rowCount%2&&o.push("xds-zooms-types-table-oddrow"),1&t.parent._recTagBorders&&o.push("xds-tagrow-leadspan"),2&t.parent._recTagBorders&&o.push("xds-tagrow-trailspan"),t.proxyCSS&&o.push(t.cssPath.split("-").slice(0,-1).join("-")),o.push(t.cssPath.split("-").slice(0,-1).join("-")),o.reverse(),e.layout.isPhone()?function(e,t,r){e.pretag('<div class="'+t.join(" ")+'">')}(t,o,t.parent._recTagColspan):function(e,t,r){e.pretag('</tr><tr class="'+t.join(" ")+'"><td class="xds-tagcell"'+(r?'colspan="'+r+'"':"")+">")}(t,o,t.parent._recTagColspan),t.ready(r),t.sparse=n=!0),s&&("zooms.types.tag"===s.type||s.tableTagField)||(e.layout.isPhone()?function(e){e.postclosetag("</div>")}(t):function(e){e.postclosetag("</td>")}(t),t.sparse||(t.temp.border_tag=!0),t.sparse=n=!0),n},t}(),zoom:function(){function e(e,t,r){e.caller().trigger("xds-lightbox-picker-set-items",r)}return function(t){t.data.mode!==a?t.build.mode=t.data.mode:s(t,"mode",!0)&&(t.build.mode=s(t,"mode",!0)),n.funcs.isPicker(t,a,"dd")&&t.on("xds-unload","zooms.events.picker_close"),n.funcs.isPicker(t)&&t.on("xds-lightbox-picker-set-items",e),n.funcs.getURLParameter(t,"stage",!0)||(t.arg("ttag")?t.inherit(t.arg("ttag")):t.inherit("fluidPage"))}}()},events:{broadcast:function(){function t(e,t){var r;for(t.reverse();t.length;)e[r=t.pop()]===a&&(e[r]={}),e=e[r];return e||{}}function r(e,r,a){var s=r.split("-");return r=s.pop(),t(e,s)[r]=a,a}function s(e,s,o){var n,i,d=$.extend({},e.args);d.data={},s&&("none"!==(i=e.get_arg("whofld"))&&r(d.data,i||"to",s.recs),"none"!==(i=e.get_arg("nidfld"))&&r(d.data,i||"tonids",s.nids.join(".")),(i=e.get_arg("ridfld"))&&r(d.data,i,s.rids.join(",")),"none"!==(i=e.get_arg("snidfld"))&&r(d.data,i||"srcnid",e.get_val("nid","data_this")),(i=e.get_arg("idfld"))&&(n=[],(s.recs||[]).forEach(function(e){return function(e,r,s){var o,n=r.split("-");return r=n.pop(),(o=t(s,n)[r])!==a&&e.push(o),o}(n,i,e)}),r(d.data,i,n.join(",")))),o&&$.extend(d,o),e.newEvent("lightbox",d)}function o(t,r){var a,o={},n=t.dom();t.args.nourlnids?s(t,r,o):(n.on("posted",function(e,a){n.off("posted"),o.slice=a.slices[0],s(t,r,o),delete t.args.func}),(a=t.args).nid||(a.nid=t.get_val("nid","user")),a._method="GET",t.args={data:{},action:e.gen_url(a),jsonresponse:1},t.args.data[a.nidfld?a.nidfld:"_nids"]=(r.nids||[]).join("."),e.get_func("post")(t),t.args=a)}function n(t,r,a,s,n){var i=r[s]();t.args=a,o(t,i=e.get_func(n)(t,i))}return function(e,t,r){var s=e.get_xdo("*data-table"),i=$.extend(!0,{},e.args),d=s?e.get_arg("filtered")?"getFilteredRecords":"getSelectedRecords":a;e.args.filtercb&&s?e.args.filter_not_deferred?n(e,s,i,d,e.args.filtercb):s.loadAllDeferred(s).then(function(){n(e,s,i,d,e.args.filtercb)}):o(e,d?s[d]():[])}}(),clearSelected:function(t,r,a){e.get_obj(t.get_target(t.get_arg("target"),1)).clearAllSelected()},deleteSelected:function(){function t(t,r,a){for(var s=t.temp.postrids,o=(s||[]).length;o--;)e.removeRef(s[o]);t.trigger("xds-zoom-items-deleted")}return function(e,r,a){e.event("zooms.events.doPostOnSelected",{command:"delete",postcb:t})}}(),doPostOnSelected:function(){function e(e,t){var r=$(this),a=r.xdo,s=a.get_target(a.get_arg("target")||"this:ZoomCore-data-table",1).xdo,o=a.temp||{};o.postcb&&(o.postcb(a,r,s),delete o.postcb),delete o.postnids,delete o.postrids,r.off("posted.selpost"),s&&s.clearAllSelected&&s.clearAllSelected(),r.removeClass("xds-zoom-posting")}return function(t,r,s){var o,n=t.get_target(t.get_arg("target")||"this:ZoomCore-data-table",1).xdo,i=n&&n.getSelectedRecords?n.getSelectedRecords():a;i&&i.nids.length&&!t.temp.postnids&&(r.addClass("xds-zoom-posting"),t.temp.postnids=i.nids,t.temp.postrids=i.rids,r.on("posted.selpost",e),o={nid:t.get_val("nid","node")+"/"+i.rids[0]+"/"+i.nids[0],noPath:!0,xds:t.get_arg("xds")||t.arg("xds")},t.get_arg("command")&&(o.command=t.get_arg("command")),t.get_arg("postcb")&&(t.temp.postcb=t.get_arg("postcb")),i.nids.length>1&&(o.data={_nids:i.nids.slice(1).join("."),_rids:i.rids.slice(1).join(".")}),t.newEvent("post",o))}}(),export:function(e,r,a){var s,o,n,i=e.get_target(e.get_arg("target")||"*data-table",1),d=i.xdo,l=e.arg("href")||e.arg("link");e.e.stopPropagation(),e.e.preventDefault(),(n=d.getFilteredRecords())&&(o=n.rids.join(",")),o&&((s=d.temp.form)?(s.attr("action",l),s.find("input").val(o)):(s=d.temp.form=$('<form action="'+l+'" method="POST" style="display:none;"><input type="hidden" name="filterrids" value="'+o+'"></form>')).insertAfter(i),s)?s.submit():t.location=l},facet:function(e,t,r){var s,o=e.get_arg("facetdeferred"),n=e.get_xdo(e.arg("target")).find(".xds-zooms-types-table").xdo;!o&&n&&e.get_arg("filter")!==a&&(o=n.arg("filterDeferred")&&n.hasDeferred()),n&&o&&(e.stopPropagation(),e.preventDefault(),s=$.extend(!0,{},r),n.loadAllDeferred(n).then(function(){e.newEvent("facets.faceted",s)}))},gearClick:function(t,r,a){var s,o,n=t.parents(".xds-zooms-types-table").xdo,i=e.storage(n.getGearStoragePath("selected"));r.hasClass("xds-zooms-types-gearCol")?o=r:((s=r.hasClass("xds-zoomtable-body")?r:t.parents(".xds-zoomtable-body")).length||(s="tr"===r[0].tagName?t:t.parents("tr")),o=s.find(".xds-zooms-types-gearCol")),t.rnode._gearselect?(delete t.rnode._gearselect,o.removeClass("checked"),0==--n.temp.nSelected?(n.temp.selrecs&&delete n.temp.selrecs,i=-1):(delete n.temp.selrecs["r"+t.rnode.rid],delete i["r"+t.rnode.rid]),--n.temp.nVisSelected):(t.rnode._gearselect=!0,o.addClass("checked"),++n.temp.nSelected,++n.temp.nVisSelected,i||(i={}),i["r"+t.rnode.rid]=t.rnode.nid,n.temp.selrecs||(n.temp.selrecs={}),n.temp.selrecs["r"+t.rnode.rid]=t.rnode),e.storage(n.getGearStoragePath("selected"),i),n.trigger("xds-zoom-selection-changed",{gearmode:n.temp.gearmode,nSelected:n.temp.nSelected,selected:i})},gearTitleClick:function(e,t,r){e.setAllSelected(e.temp.nVisSelected!==e.temp.nVisible)},load_static_stage:function(e,t,r){var o,n,i=["profile","mode","start","end","spage","max","offset","sort","rev","name","pattern","fields","thread"];if(!s(e,"stage",!0)){o={xds:e.xds_full.id,nid:e.build.hash.split("?")[0].split("/").pop(),noPath:!0,noForm:!0,facetSave:e.build.isPageReload},(n=e.xds_full.propagate_args)&&(i=i.concat(n.split(",")));var d=!0,l=!1,c=a;try{for(var g,p=i.values()[Symbol.iterator]();!(d=(g=p.next()).done);d=!0){var u=g.value;(n=s(e,u,!0))!==a&&(o[u]=n)}}catch(e){l=!0,c=e}finally{try{d||null==p.return||p.return()}finally{if(l)throw c}}e.event("loadxds",o)}},picker_close:function(e,t,r){e.caller().trigger("xds-lightbox-picker-closed")},pickerClick:function(e,t,r){e.event("zooms.events.gearClick"),n.funcs.isPicker(e,!0)&&e.event("zooms.events.pickerSelect")},pickerSelect:function(t,r,a){var s,o,i=t.get_target(t.get_arg("target")||"*data-table",1).xdo,d=i.getFilteredRecords(),l=[],c=[];if(d){try{s=i.temp.row.pickertitle}catch(e){}s||(s="name"),s=s.split("-");for(var g=Object.entries(d.recs),p=0;p<g.length;p++){var u=_slicedToArray(g[p],2),f=u[0],m=u[1];"_r"!==f&&(o=m.nid,c.push(o),l.push({value:o,display:e.search(s,m)||o,data:m}))}t.caller().trigger("xds-lightbox-picker-set-items",{value:c.join(","),items:l,clear:n.funcs.isPicker(t,!0)}),i.event("zooms.events.clearSelected")}t.arg("noCloseOnSelect")||t.event("lightbox.close")},selectionChanged:function(e,t,r){t[r.gearmode?"addClass":"removeClass"]("xds-zoom-gearmode-engaged"),t[r.nSelected?"addClass":"removeClass"]("xds-zoom-hasselected"),t[r.nSelected?"removeClass":"addClass"]("xds-zoom-noselected"),t.find(".ZoomCore-data-options-total-selected-count").text(r.nSelected)},toggleGearMode:function(t,r,a){var s,o=t.get_target(t.get_arg("targetZoom")||t.arg("targetZoom")||"this:ZoomBase-zoom-data-table",1).xdo;o&&(s=e.storage(o.getGearStoragePath("enabled"))||-1,e.storage(o.getGearStoragePath("enabled"),-1===s?1:-1),e.get_func("redraw")(t))},updateCounts:function(t,r,a){var s=$(".ZoomCore-data-options-total-counter"),o=s.xdo;s.text(""),e.displayVal.filteredRefCount(o,o.xds.displayVal),o=(s=$(".ZoomCore-data-options-total-total")).xdo,s.text(e.displayVal.refCount(o,o.xds.displayVal))}},funcs:{canOpenClass:function(t){return t.has_role("Administrator")||t.has_role("Guidance")||t.has_role("SysAdmin")||-1!==(t.get_val("teachernids","rnode")||"").split(",").indexOf(""+e.gbl.user.nid)},defer_state:function(e,t){return e.rnode._deferred_loaded||1>=t},getURLParameter:s,isPicker:function(e,t,r){var a,s=e.build.mode||e.get_setting("mode"),o=!1,n=!1,i=!1;return s&&(n=!(o=-1!==(s=s.split(".")).indexOf("pickone"))&&-1!==s.indexOf("picker"),r&&(i=-1!==s.indexOf(r))),a=t?o:!1===t?n:o||n,r&&a&&(a=i),a}}};return $.extend(e.sort,{zoomGenderSort:function(t,r,a,s){return a.sortLookup="gender",e.sort.lookup.apply(this,arguments)},zoomGradeSort:function(t,r,a,s){return a.sortLookup="gradeLevel","string"==typeof t&&t.toUpperCase(),e.sort.lookup.apply(this,arguments)},zoomLSRSubNeedSort:function(t,r,a,s){return a.sortLookup="subNeedType",e.sort.lookup.apply(this,arguments)},zoomLSRYearLevelSort:function(t,r,a,s){if(a.sortLookup="lsryearlevels","string"==typeof t&&(t=t.toUpperCase()),"ECE"===t){if(r.birthdate){var o=(new Date-new Date(r.birthdate))/31536e6;return o<3?-98:Math.min(o-100,0)}return-100}return e.sort.lookup.apply(this,arguments)},zoomLoginSort:function(){function e(e,t,r,a){var s=r._activation-a._activation;return s||(s=r.lastActivity.localeCompare(a.lastActivity)),s||(s=r.lastInvite.localeCompare(a.lastInvite)),s}return function(t,r,a,s){return r._activation=parseInt(r.accountStatus,10),r.lastActivity||(r.lastActivity=""),r.lastInvite||(r.lastInvite=""),e}}(),zoomNameListSort:function(){function e(e,t){return e&&t?e.name&&t.name?e.name.localeCompare(t.name):e.name?1:t.name?-1:e.nid-t.nid:e?1:t?-1:0}return function(t,r,s,o){return t&&t.length?(t.sort(e),t[0].name):a}}()}),n});

/* resources: UberPlanner */

"use strict";cf.resource("UberPlanner",function(e,a,t){var n={_debug:!0,_defs:{ADAYOFMILLIS:864e5,filterMap:{schedule:{hidden:"xds-UberPlanner-hideSchedule",visible:"xds-UberPlanner-showSchedule"},assessments:{hidden:"xds-UberPlanner-hideAssessments",visible:"xds-UberPlanner-showAssessments",selector:{checkbox:".UberPlannerFilters-assessments-assessments"}},events:{hidden:"xds-UberPlanner-hideEvents",visible:"xds-UberPlanner-showEvents",selector:{checkbox:".UberPlannerFilters-events-events"}},journals:{hidden:"xds-UberPlanner-hideJournals",visible:"xds-UberPlanner-showJournals",selector:{checkbox:".UberPlannerFilters-journal-journal"}},lessons:{hidden:"xds-UberPlanner-hideLessons",visible:"xds-UberPlanner-showLessons",selector:{checkbox:".UberPlannerFilters-lessons-lessons"}}}},recordSanityCheck:function(e,a,t){null!=t?(n._config._sanityChecks[e]||(n._config._sanityChecks[e]={}),n._config._sanityChecks[e][a]||(n._config._sanityChecks[e][a]=[]),n._config._sanityChecks[e][a].push(t)):(n._config._sanityChecks[e]||(n._config._sanityChecks[e]=[]),n._config._sanityChecks[e].push(a))},_sanityCheckCallbacks:{orphaned:function(a){var t=$(".UberPlanner-header-warningBox");t.show();var s=["<div class='warning orphans'>","<span class='warningIcon'></span>",e.tpl(e.lang("<b>Warning:</b> There are {{number}} Assessments without Units. "),{number:a.length}),"<a id='xds-fix-orphans","' class='xds-UberPlanner-fixOrphans'>",e.lang("Click here to assign them to a new unit."),"</a>","<div class='actions'>","<span class='close xds-icon'>&nbsp;</span>","</div>","</div>"];t.append(s.join("")),$(".xds-UberPlanner-fixOrphans").on("click",function(t){var s=e.lang("Orphaned Documents"),i={"bookPlanEntryForm-nodetype":"6.4","bookPlanEntryForm-unit-section-name":s},r=function(t){for(var s=[],i=[],r=0;r<a.length;r++)s.push(a[r]);!function a(){var r=s.pop();if(r){var d="UberPlannerUpdateDueDate";r.nt()==e.nt.Document.Lesson()&&(d="UberPlannerUpdateLessonDate"),e.post({data:{thread:t},url:{command:"node",xds:d,nid:r.cnid()},callback:function(){i.push(r),a()}})}else e.get_func("copyComplete")(n._config.t)}()},d=!1;if(n._config&&n._config.units)for(var o in n._config.units)if(n._config.units[o]&&n._config.units[o].data&&n._config.units[o].data.name&&n._config.units[o].data.name==s){d=n._config.units[o];break}d?r(d.t.nid()):e.post({data:i,url:{command:"create",xds:"bookPlanUnitEntry",nid:e.gbl.nid,nodetype:6,nodesubtype:4},callback:function(e){var a=e.nid;r(a)}}),e.diagnosticMessage("UberPlanner Orphan Fix Run","UberPlanner Sanity Check")}),$(".UberPlanner-header-warningBox .warning.orphans .close").on("click",function(e){$(this).closest(".warning").remove(),0==$(".UberPlanner-header-warningBox").children().length&&$(".UberPlanner-header-warningBox").remove(),n._sanityCheckCallbacks._updatemargin()}),n._sanityCheckCallbacks._updatemargin()},_updatemargin:function(){var e=$(".UberPlanner-header-warningBox"),a=170;$("body").hasClass("native")&&(a-=34);var t=a+e.height();e.is(":visible")||(t=a),$(".UberPlanner").css("margin-top",t+"px")},unitNames:function(a){var t=$(".UberPlanner-header-warningBox");t.show();for(var s=0;s<a.length;s++){var i=a[s],r=n._config.units[i[0]].data.name,d=["<div class='warning unitNames'>","<span class='warningIcon'></span>",e.tpl(e.lang('<b>Warning:</b> There are {{number}} Units named "{{name}}". '),{number:i.length,name:r||""}),"<a id='xds-merge-",s,"' class='xds-UberPlanner-mergeUnits'>",e.lang("Click here to merge these units automatically"),"</a>","<div class='actions'>","<span class='close xds-icon'>&nbsp;</span>","</div>","</div>"];t.append(d.join(""))}$(".xds-UberPlanner-mergeUnits").on("click",function(t){var s=parseInt(this.id.replace("xds-merge-","")),i=a[s];n.fn.mergeUnits(i),e.diagnosticMessage("UberPlanner Unit Merge Run","UberPlanner Sanity Check")}),$(".UberPlanner-header-warningBox .warning.unitNames .close").on("click",function(e){$(this).closest(".warning").remove(),0==$(".UberPlanner-header-warningBox").children().length&&$(".UberPlanner-header-warningBox").remove(),n._sanityCheckCallbacks._updatemargin()}),n._sanityCheckCallbacks._updatemargin()},assessmentDates:function(a){var t=$(".UberPlanner-header-warningBox");t.show();var s=["<div class='warning assessmentDates'>","<span class='warningIcon'></span>",1==a.length?e.lang("<b>Warning:</b> One assessment does not have a date set. This <b>will</b> prevent it from being included in a report card."):e.tpl(e.lang("<b>Warning:</b> {{number}} assessments do not have dates set. This <b>will</b> prevent them from being included in a report card."),{number:a.length}),"<div class='actions'>","<span class='close xds-icon'>&nbsp;</span>","</div>","</div>"];t.append(s.join("")),$(".UberPlanner-header-warningBox .warning.assessmentDates .close").on("click",function(e){$(this).closest(".warning").remove(),0==$(".UberPlanner-header-warningBox").children().length&&$(".UberPlanner-header-warningBox").remove(),n._sanityCheckCallbacks._updatemargin()}),n._sanityCheckCallbacks._updatemargin()}},_utils:{isToday:function(e){var a=new Date;return e.getFullYear()==a.getFullYear()&&e.getMonth()==a.getMonth()&&e.getDate()==a.getDate()},isDateInRange:function(e,a,t){return e.getTime()<=t.getTime()&&t.getTime()<=a.getTime()},isSameDay:function(e,a){return e.getFullYear()==a.getFullYear()&&e.getMonth()==a.getMonth()&&e.getDate()==a.getDate()},getDateUntimedFromDate:function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0)},compareDatesNoTime:function(e,a){var t=n._utils.getDateUntimedFromDate(e),s=n._utils.getDateUntimedFromDate(a);return t.getTime()>s.getTime()?1:t.getTime()==s.getTime()?0:-1},dateToISO:function(a){var t=n._utils.getNormalizedDates(a);return 2==a.split(" ").length&&"00:00:00"==a.split(" ")[1]||1==a.split(" ").length?e.dateFormat(t.parsedDate,"iso"):a},getNormalizedDates:function(a){var t=a;return"string"==typeof a?t=e.parseDate(a):a=e.dateFormat(a,"yyyy-mm-dd"),{date:a,parsedDate:t}},getBracketingDates:function(e){var a={inMap:!1,before:!1,after:!1};0!=n._utils.isDateInMap(e)&&(a.inMap=!0);for(var t=0;t<n._config.dateMap.length;t++){var s=n._config.dateMap[t],i=n._utils.compareDatesNoTime(e,s.parsed);if(i>0)a.before=s;else if(i<0){a.after=s;break}}return a},getUnitsForDate:function(e){var a,t=[],s=n._utils.getNormalizedDates(e),i=n._utils.getDateUntimedFromDate(s.parsedDate);for(var r in n._config.units)n._config.units.hasOwnProperty(r)&&(a=n._config.units[r])._parsedSdate&&a._parsedEdate&&n._utils.getDateUntimedFromDate(a._parsedSdate).getTime()<=i.getTime()&&n._utils.getDateUntimedFromDate(a._parsedEdate).getTime()>=i.getTime()&&t.push(a);return t},getUnitByID:function(e){var a=!1;return"#"!=e.charAt(0)&&(e="#"+e),n._config._unitsByDomID[e]&&(a=n._config.units[n._config._unitsByDomID[e]]),a},addDateToForwardMap:function(e,a,t){for(var s,i=n._utils.getNormalizedDates(e),r=i.parsedDate,d=i.date,o=(n._utils.getDateUntimedFromDate(r).getTime(),{date:d,parsed:r,scheduled:a,hasItems:t}),l=0;l<n._config.dateMap.length;l++){if(n._utils.isSameDay(n._config.dateMap[l].parsed,r))return n._config.dateMap[l].scheduled!=a&&(n._config.dateMap[l].scheduled=n._config.dateMap[l].scheduled||a),void(t&&(n._config.dateMap[l].hasItems=t));if(n._config.dateMap[l].parsed.getTime()>r.getTime()){s=l;break}}void 0===s?n._config.dateMap.push(o):n._config.dateMap.splice(s,0,o)},addDateToReverseMap:function(e,a){n._utils._generalReverseDateMapFunc(e,!0).push(a)},getTimeDiff:function(e,a){var t=!1;if(a._parsedSdate&&(t=Math.abs(a._parsedSdate.getTime()-e.getTime())),a._parsedEdate){var n=Math.abs(a._parsedEdate.getTime()-e.getTime());t&&n<t&&(t=n)}return t},getNearestUnitToDate:function(e){var a=n._utils.getNormalizedDates(e),t=-1,s=!1;if(n._config&&n._config.units){for(var i in n._config.units)if(n._config.units.hasOwnProperty(i)){var r=n._config.units[i];if(r._parsedSdate||r._parsedEdate)if(s){var d=n._utils.getTimeDiff(a.parsedDate,r);d<t&&(t=d,s=r)}else s=r,t=n._utils.getTimeDiff(a.parsedDate,r)}return!!s&&{unit:s,timeDiff:t}}},rebuildReverseDateMap:function(){n._config.reverseDateMap={},n._config.dateMap.sort(function(e,a){return e.parsed.getTime()-a.parsed.getTime()});for(var e=0;e<n._config.dateMap.length;e++)n._utils.addDateToReverseMap(n._config.dateMap[e].parsed,e)},getDateFromRow:function(e){for(var a=e.attr("class").split(" "),t=0;t<a.length;t++)if(a[t].indexOf("truedate")>=0)return a[t].split("-").splice(1,3).join("-")},getRowForDate:function(a){var t=n._utils.getNormalizedDates(a);return $(".truedate-"+e.dateFormat(t.parsedDate,"yyyy-mm-dd"))},getRowForYPosition:function(e){for(var a=n._config._rows,t=0;t<a.length;t++){var s=$(a[t]),i=s.position(),r=s.height();if(i.top<=e&&i.top+r>=e)return s}},isDateInMap:function(e){return n._utils._generalReverseDateMapFunc(e,!1)},_generalReverseDateMapFunc:function(e,a){var t=[];"string"==typeof e?t=e.split("-"):(t.push(e.getFullYear()),t.push(e.getMonth()+1),t.push(e.getDate()));for(var s=0;s<t.length;s++)t[s]=parseInt(t[s],10);for(var i=n._config.reverseDateMap,r=0;r<2;r++){if(!i[t[r]]&&a)i[t[r]]={};else if(!i[t[r]]&&!a)return!1;i=i[t[r]]}return i[t[2]]||a&&(i[t[2]]=[]),i[t[2]]},setFieldData:function(e,a,t){if(2!=arguments.length){a=a.split("-");for(var s=e.data,i=!1,r=0;r<a.length-1;r++)s[i=a[r]]||(s[i]={}),s=s[i];s[a[a.length-1]]=t}else for(var d in a)a.hasOwnProperty(d)&&n._utils.setFieldData(e,d,a[d])},sanityCheckUnitNames:function(e){n.recordSanityCheck("unitNames",e.data.name,e.nid())},sanityCheckData:function(e){for(var a=["sdate","edate","assdate","duedate"],t=!1,n=0;n<a.length;n++){var s=a[n];!e[s]||0!=e[s].indexOf("1969")&&0!=e[s].indexOf("1970")||(t=!0,delete e[s])}return t},sanityCheckDates:function(e){n._utils.sanityCheckData(e.data)&&n.recordSanityCheck("badDate",e)},get_func:function(a){return n.fn[a]?n.fn[a]:e.get_func(a)},generateFileHTML:function(a,t,n){if(t&&t.ContentType){var s=t.ContentType,i=e.gbl.p+"core/nodedl/{{nid}}?field={{field}}&xds={{fileXds}}{{sizesuffix}}{{suffix}}",r=[],d=a.get_val("nid"),o="file",l="fileThumbnail",c=e.tpl("&size={{size}}",{size:256}),g=e.gbl.sys.fileTypeIcons,f="";if(n&&(d=n),e.get("files")._getFilePublicThumbnailUrl(a,!1,t)&&(i=e.get("files")._getFilePublicThumbnailUrl(a,!1,t)),"image"!==s.substr(0,5)||~s.indexOf("photoshop")||~s.indexOf("tiff")){o="file",l="fileView",f="&attach=1";var p=e.gbl.sys.fileTypeScale,u=s.substr(s.indexOf("/")+1),h=void 0!==g[u]?g[u]:0;r=['<div class="xds-fileThumbnail-inline xds-fileThumbnail-icon xds-fileThumbnail xds-UberPlanner-fileThumbnail">',"<a href='",i,"' target='_blank'>",'<div style="background-position:-'+(h=h*p[16]-2)+'px 0px;" class="xds-fileThumbnail-sprite xds-fileThumbnail-sprite16">'+u+"</div>",'<p class="xds-fileThumbnail-name">{{name}}</p>',"</a>","</div>"]}else r=['<div class="xds-fileThumbnail-image xds-fileThumbnail xds-UberPlanner-fileThumbnail">','<div class="xds-screen" style="max-height:{{size}}px;max-width:{{size}}px;">',"<img src='",i,"' style='max-height:{{size}}px;max-width:{{size}}px;'>","</div>","</div>"];return e.tpl(r.join(""),{nid:d,field:o,sizesuffix:c,fileXds:l,name:t.ContentName,size:256,suffix:f})}if(t&&[t.nodetype,t.nodesubtype].join(".")==e.nt.Document.Bookmark()&&t.field){var _=[];try{var m=JSON.parse(t.field);m.description=e.mlescape(m.title||""),m.thumbnailUrl=e.tpl("{{dl}}/{{nid}}?xds=fileThumbnail&field=file&size=64",{nid:t.NID,dl:e.gbl.dl}),_.push(e.tpl("<div class='xds-screen'><a href='{{href}}' target='_blank' style='height:64px;width=64px;' alt='{{description}}'><img src='{{thumbnailUrl}}'/></a></div>",m))}catch(e){}return _.join("")}return""}},Generators:{templates:{yearRow:['<div id="yearRow-{{year}}" class="xds-UberPlanner-yearRow">','<div class="yearTitle">{{year}}</div>',"</div>"].join(""),dateRow:['<div id="truedate-{{shortdate}}" class="xds-UberPlanner-date xds-UberPlanner-date-real truedate-{{shortdate}} classno-{{index}} xds-has-click {{todayclass}} {{classNames}}','" index="{{index}}">','<div class="pre"></div>','<div class="body">','<div class="dateblock">','<span class="weekday">{{weekday}}</span>','<span class="month">{{month}}</span>','<span class="day">{{day}}</span>','<span class="index">{{index}}</span>',"</div>",'<div class="documents">{{documents}}</div>','<div class="inlineCreate"></div>','<div class="onhovers"></div>',"</div>","</div>"].join(""),Unit:['<div id="{{id}}" class="Unit {{classNames}} xds-copier-copyTarget">','<span class="moveHandle">&nbsp;</span>','<span class="unitNo" title="{{name}}">'+e.lang("Unit")+": {{name}}</span>",'<div class="xds-copier-copyInput"><input type="checkbox" id="{{id}}-select" class="xds-customizedNativeCheckbox"><label class="xds-form-sprite" for="{{id}}-select">&nbsp;</label></div>','<span class="xds-UberPlanner-visibilityState">Hidden</span>',"</div>"].join(""),Doc:['<div id="{{id}}" class="Document {{classNames}} xds-copier-copyTarget xds-UberPlanner-doc">','<span class="dragHandle">&nbsp;</span>','<div class="{{cbClass}}"><input type="checkbox" id="{{id}}-select" class="xds-customizedNativeCheckbox"><label class="xds-form-sprite" for="{{id}}-select">&nbsp;</label></div>','<span class="prefix">{{prefix}}</span>','<span class="name">{{name}}</span>',"{{post}}",'<span class="xds-UberPlanner-visibilityState">'+e.lang("Hidden")+"</span>","</div>"].join(""),Journal:['<div id="{{id}}" class="{{classNames}} xds-copier-copyTarget xds-UberPlanner-doc">','<span class="dragHandle">&nbsp;</span>','<div class="xds-copier-copyInput"><input type="checkbox" id="{{id}}-select" class="xds-customizedNativeCheckbox"><label class="xds-form-sprite" for="{{id}}-select">&nbsp;</label></div>','<div class="data">','<div class="{{bodyclass}} xds-richtext-types-richText"><b>'+e.lang("Topics Covered")+":</b> {{body}}</div>",'<div class="{{todoclass}} xds-richtext-types-richText"><b>'+e.lang("To Do")+":</b> {{todo}}</div>","{{file}}","</div>",'<span class="xds-UberPlanner-visibilityState">'+e.lang("Hidden")+"</span>","</div>"].join(""),fakeDayRow:['<div class="xds-UberPlanner-date xds-has-click xds-UberPlanner-fakeDate {{classNames}}" id="{{id}}">','<div class="dateblock dateset">{{datestr}}',"</div>",'<div class="documents">{{html}}</div>','<div class="onhovers"></div>',"</div>"].join("")},YearRow:function(a){return e.tpl(n.Generators.templates.yearRow,{year:a})},DateRow:function(a){var t={4.14:"xds-contains-Journal",6.5:"xds-contains-Lesson",6.3:"xds-contains-Assessment",6.2:"xds-contains-Event",6.24:"xds-contains-ReportingPeriod"};if(n._config.dateMap[a]){var s=n._utils.isToday(n._config.dateMap[a].parsed),i=n._config.dateMap[a].parsed,r={shortdate:e.dateFormat(i,"yyyy-mm-dd"),month:e.dateFormat(i,"mmm"),day:e.dateFormat(i,"dd"),index:a+1,weekday:e.dateFormat(i,"ddd"),todayclass:s?" xds-UberPlanner-date-today":"",documents:"",classNames:""};n._config.dateMap[a].scheduled?r.classNames="scheduled":r.classNames="unscheduled";var d=[],o={};for(var l in n._config._docs)if(n._config._docs.hasOwnProperty(l)){var c=n._config._docs[l],g="";if(c.data.file||c.data.files){if(g="<div class='xds-uberPlanner-fileThumbnail-wrap'>",c.data.file&&(g+=n._utils.generateFileHTML(c.t,c.data.file)),c.data.files&&c.data.files.length>0)for(var f=0;f<c.data.files.length;f++)g+=n._utils.generateFileHTML(c.t,c.data.files[f].Content,c.data.files[f].nid);g+="</div>"}var p={body:c.data.body||"",todo:c.data.todo||"",id:c.t.id().replace("#",""),name:c.data.name||"",prefix:c.data._type||c.data.type||"",classNames:"",post:"",file:g,cbClass:"xds-copier-copyInput",pre:""},u=n._config.units[c.data.thread];if(u&&u.colorClass&&(p.classNames=u.colorClass.replace(" xds-UberPlanner-hidden","")),3==c.data.state&&(p.classNames+=" xds-UberPlanner-hidden"),p.prefix.length>0&&(p.prefix+=": "),"4.14"==c.t.nt()&&c.data._parsedDate&&n._utils.isSameDay(c.data._parsedDate,i))p.classNames+=" Journal",p.bodyclass=p.body.length>0?"body":"hidden",p.todoclass=p.todo.length>0?"todo":"hidden",d.push(e.tpl(n.Generators.templates.Journal,p)),t[c.t.nt()]&&(o[t[c.t.nt()]]=!0);else if(c.data._parsedDate&&n._utils.isSameDay(c.data._parsedDate,i)){if(c.t.nt()==e.nt.Document.Lesson())p.prefix=e.lang("Lesson: "),p.classNames+=" Lesson";else if("6.24"==c.t.nt())p.classNames+=" ReportingPeriod",p.cbClass="xds-copier-unselectable",c.t.cssPath.indexOf("reportingPeriodStarts")>=0?p.name=e.tpl(e.lang('Reporting Period "{{name}}" Starts'),{name:p.name}):p.name=e.tpl(e.lang('Reporting Period "{{name}}" Ends'),{name:p.name});else if(c.t.nt()==e.nt.Document.Event()){if(p.prefix=e.lang("Event: "),p.classNames+=" Event",!c.data.allday){var h=e.parseDate(c.data.sdate),_=new Date(h.getTime()+1e3*c.data.duration),m=e.dateFormat(h,"HH:MM"),v=e.dateFormat(_,"HH:MM");0==h.getMinutes()&&(m=e.dateFormat(h,"htt")),0==_.getMinutes()&&(v=e.dateFormat(_,"htt"));var b=m+" - "+v;p.prefix+="<span class='timeSpan'>"+b+"</span>"}c.data.pnid!=e.gbl.nid&&c.data.pname&&(p.post+="<div class='parent highlightBubble'>"+c.data.pname+"</div>"),c.data.location&&(p.post+="<div class='location'>"+c.data.location+"</div>")}else{if(p.classNames+=" Assessment",c.data.scheme){for(var x=n._config.t.xds.fields.schemes._children,D=!1,y=0;y<x.length;y++)if(x[y].id==c.data.scheme){D=x[y];break}if(D){var U=D._title;try{var P=!1;if((P=c.data.gsData?JSON.parse(c.data.gsData):!!c.data.weighting&&JSON.parse(c.data.weighting))&&0!=(2&c.t.get_perm(c.t.arg("xdsedit")))){for(var k=D.fields.cols._children,C=[],T=0;T<k.length;T++)P[k[T].name]&&0!=parseInt(P[k[T].name])&&C.push((k[T].shortName?k[T].shortName:D._title?D._title:"")+"/"+P[k[T].name]);C.length>0&&(U=C.join(" ")),"gs_outof"==c.data.scheme&&P[0]&&(U="/"+P[0])}}catch(e){}p.name+="<div class='gradeScheme highlightBubble'>"+U+"</div>"}}if(c.data.graded&&(p.name+="<div class='graded highlightBubble'>"+e.lang("Graded")+"</div>"),c.t.nt()===e.nt.Document.IndividualAssessment()&&!c.t.has_role("Student")){var w=c.t.data.students?e.lang("Individualized"):e.lang("Unassigned");p.classNames+=" IndividualAssessment",p.name+='<span class="xds-doc-individualized highlightBubble" style="margin-right: 5px;">'.concat(w,"</span>")}}var $=e.tpl(n.Generators.templates.Doc,p);"6.24"!=c.t.nt()&&"6.2"!=c.t.nt()||($=$.replace('<div class="xds-copier-copyInput"><input type="checkbox"></div>',"")),d.push($),t[c.t.nt()]&&(o[t[c.t.nt()]]=!0)}}if(0==d.length)r.classNames+=" xds-UberPlanner-date-nodocuments";else for(var M in o)o.hasOwnProperty(M)&&(r.classNames+=" "+M);return r.documents=d.join(""),e.tpl(n.Generators.templates.dateRow,r)}return""},Unit:function(a,t,s,i){var r={id:a.id.replace("#",""),name:a.data.name||"",classNames:"color"+(t-1)%6+(3==a.data.state?" xds-UberPlanner-hidden":"")+(i?" "+i:"")};return a.colorClass=r.classNames,e.tpl(n.Generators.templates.Unit,r)}},fn:{inferInlineInputMeaning:function(e,a,t){var n,s=e.child("name",1).find("input").val(),i=s;s=s?s.toLowerCase():"";for(var r=e.xds.fields.schemes._children,d={},o=0,l=0;l<r.length;l++){var c=r[l],g=c._kw,f=c.id,p=!1;g||(g=[]),c._title&&g.push(c._title);for(var u=0;u<g.length;u++)if(s.indexOf(g[u].toLowerCase())>=0){p=g[u];break}if(p){d[f]={gs:c,match:p},o++;break}}if(0==o&&s.indexOf("/")>=0)for(var h=0;h<r.length;h++)if("gs_outof"==r[h].id){d.gs_outof={gs:r[h],match:""};break}for(var _ in d){var m=void 0;if(d.hasOwnProperty(_)){if(e.child("scheme",1).val(_),s=s.replace(d[_].match,""),i=i.replace(new RegExp(d[_].match,"i"),""),(s=s.replace(/\s+/g," ")).indexOf("/")>=0){try{for(var v=d[_].gs,b=!1,x=0;x<v._children.length;x++)if("cols"==v._children[x].id){b=v._children[x]._children;break}if(n=(m=s.split("/"))[1],n=parseInt(n.split(" ")[0]),"gs_outof"==v.id||"gs_egsn"==v.id)n={0:n};else if(b){for(var D={},y=0;y<b.length;y++)D[b[y].name]=n;n=D}var U=JSON.stringify(n);e.child("gsData",1).val(U),e.child("weighting",1).val(U)}catch(e){}s=m[0]}break}}e.child("name",1).find("input").val(i)},copyComplete:function(e,a,t){n.fn.toggleGearMode(e,a,t),$(".UberPlanner").trigger("PlannerDataChanged")},copierGetAltProps:function(e,a,t){if(!n._config||n._config&&!n._config.dateMap)return!1;var s={schedule:n._config.dateMap},i=[];for(var r in n._config.units)n._config.units.hasOwnProperty(r)&&i.push(n._config.units[r].data);if(s.allThreads=i,"directpaste"==t){s.fromDate=e.global("hoverTargetDate");var d=n._utils.getUnitsForDate(s.fromDate);if(d.length){for(var o=[],l=0;l<d.length;l++)o.push(d[l].data);s.threadsToMap=o}}return"move"==t&&(s.fromDate=e.global("unitMoveDate")),n._config.mode==n._config._modes.undated&&(s.saveIndexes=!0,s.indexMap={sdate:"upSIndex",edate:"upEIndex",date:"upIndex"}),s},copierGetSelection:function(a,t,s){if(0==s.indexOf("move")){var i,r=s.split(":");i=2==r.length?r[1]:a.nid();var d=n._config.units[i],o=[];if(d){o.push(d.t);for(var l=0;l<d.docs.length;l++)o.push(d.docs[l].t)}return o}for(var c,g=$([".xds-uberPlannerTable-Table .",e.get_module("copier")._defs.inputClass," input:checked"].join("")),f=$([".xds-uberPlannerTable-Gutter .",e.get_module("copier")._defs.inputClass," input:checked"].join("")),p={},u=[],h={},_={},m=0;m<g.length;m++)if(c=$($(g[m]).closest("."+e.get_module("copier")._defs.targetClass)),n._config._docMap["#"+c[0].id]){var v=n._config._docMap["#"+c[0].id];v.data.thread&&!p[v.data.thread]&&v.data.thread!=v.data.nid&&n._config.units[v.data.thread]&&(p[v.data.thread]=n._config.units[v.data.thread].t),v.data.thread&&(h[v.data.thread]||(h[v.data.thread]=[]),h[v.data.thread].push(v)),u.push(v.t)}for(var b=0;b<f.length;b++){c=$($(f[b]).closest("."+e.get_module("copier")._defs.targetClass));var x=n._utils.getUnitByID(c[0].id);x&&(_[x.t.nid()]=!0,p[x.t.nid()]=x.t)}var D=[];if("del"!=s&&"update"!=s||f.length>0)for(var y in p)if(p.hasOwnProperty(y)){var U=p[y];!_[U.nid()]||h[U.nid()]&&h[U.nid()].length!=n._config.units[U.nid()].docs.length?U.preventDelete=!0:U.preventDelete=!1,D.push(U)}for(var P=0;P<u.length;P++)D.push(u[P]);return D},uberPlannerSelectionChanged:function(a,t,n){var s="All"==n.value;$("."+e.get_module("copier")._defs.inputClass+" input:visible").prop("checked",s)},uberPlannerBatchUpdateVisibility:function(a,t,n){for(var s=e.get_func("copierGetSelection")(a,null,"update"),i=0,r=0,d=function(){++i==r&&a.trigger("PlannerDataChanged")},o=n.item.dataSet,l=0;l<s.length;l++){var c=s[l],g=c.arg("xdsstate");if(g){r++;var f=c.data.pin||0;3==o?f&=-141:f|=140,c.args={func:d,no_ajax_post:!0,action:e.gen_url({command:"node",xds:g,nid:c.cnid()}),data:{"form-state":n.item.dataSet,"form-pin":f}},e.get_func("post")(c)}}},uberPlannerScrollToToday:function(e,a,t){var n=$(".xds-UberPlanner-date-today").offset();n&&$("html, body").animate({scrollTop:n.top-150})},plannerOnLoad:function(e,a,t){},toggleGearMode:function(a,t,s){n&&n._config&&(n&&n._config&&null==n._config.gearModeEnabled&&n._utils.get_func("copier.bindEvents")(a,t,s),$(".xds-UberPlanner-date ."+e.get_module("copier")._defs.inputClass).on("click",function(a){var t=$(this),s=$(t.closest("."+e.get_module("copier")._defs.targetClass));if(!t.find("input").prop("checked")){if((s=n._config._docMap["#"+s[0].id]).data.thread){var i=n._config.units[s.data.thread];if(i)$(i.id).find("."+e.get_module("copier")._defs.inputClass).find("input").prop("checked",!1)}a.stopPropagation()}}),$(".Unit ."+e.get_module("copier")._defs.inputClass).on("click",function(a){var t=$(this),s=$(t.closest("."+e.get_module("copier")._defs.targetClass)),i=n._utils.getUnitByID(s[0].id);if(i)for(var r=t.find("input").prop("checked"),d=0;d<i.docs.length;d++){var o=$(i.docs[d].t.id()+" ."+e.get_module("copier")._defs.inputClass+" input");o.is(":visible")&&o.prop("checked",r)}}),n._config.gearModeEnabled=!n._config.gearModeEnabled,n._utils.get_func("updatePlannerButtons")(a,t,s),$(".UberPlanner-header-commands-selection").css("display",n._config.gearModeEnabled?"inline-block":"none"),$(".UberPlanner").toggleClass("UberPlanner-gearModeEnabled"),n.fn.recalcUnitPositions(a))},updatePlannerButtons:function(e,a,t){var s=$(".UberPlanner-header-commands-gearMode-cut"),i=$(".UberPlanner-header-commands-gearMode-copy"),r=$(".UberPlanner-header-commands-gearMode-delete"),d=$(".UberPlanner-header-commands-gearMode-gear"),o=$(".UberPlanner-header-commands-gearMode-paste"),l=$(".UberPlanner-header-commands-gearMode-cancel"),c=$(".UberPlanner-header-commands-gearMode-visibility"),g=$(".UberPlanner-create2-paste"),f=$(".xds-copier-copyInput");n._config.gearModeEnabled?(s.show(),i.show(),r.show(),d.hide(),o.hide(),l.show(),c.show(),f.css("display","inline-block"),g.hide()):(s.hide(),i.hide(),r.hide(),d.show(),f.hide(),l.hide(),c.hide(),n._utils.get_func("copier.pasteAvailable")(e)?(o.show(),g.show()):(o.hide(),g.hide()))},inlineSaveAndValidateOrCreateUnit:function(e,a,t){(null==e.args.inferMeaning||e.args.inferMeaning)&&n._utils.get_func("inferInlineInputMeaning")(e,a,t),n._utils.get_func("saveAndValidateOrCreateUnit")(e,a,t)},saveAndValidateOrCreateUnit:function(a,t,s){a.e.stopImmediatePropagation(),a.e.preventDefault(),a.e.stopPropagation();var i=!1;if(a.args&&a.args.target&&(i=a.get_target(a.args.target)),i&&0!=i.length||(i=$(a.parents("form")[0])),i&&0!=i.length||"FORM"!=a.dom()[0].tagName.toUpperCase()||(i=a.dom()),!(i&&1==i.length&&(e.get_func("validateForm")(i.xdo,i),i.find(".xds-validate-failed").length>0))){var r=a.args.threadField,d=a;a.args.target&&0==(d=a.get_target(a.args.target,1).xdo).length&&(d=a);var o=d.child(r,1).val(),l=d.child(r,1).find("input");l.length>0&&(o=l.val());var c=function(t){a.get_xdo("*thread").val(t),!d.id(1).is("form")||d.id(1).hasClass("bookPlanEntry")&&d.id(1).is("form")?$(".bookPlanEntry-bookPlanEntryForm").trigger("bookPlanFormSave"):a.trigger("submit");var n=a.get_setting("nid")+":"+a.xdsid();e.storage(n,-1,!0)},g=!1;n&&n._config&&(g=n._config.units),g||(g={});var f=e.get("gradebook");if(f){var p=!1;if(f.unitPicker&&f.unitPicker.unitList&&(p=f.unitPicker.unitList),p)for(var u=0;u<p.length;u++)g[p[u].nid]=!0}if(o&&-1!=parseInt(o)&&-4!=parseInt(o)&&!isNaN(parseInt(o))&&g[parseInt(o)])c(o);else{var h=a.args,_=!1,m=!1,v=$(".UberPlanner"),b=!1;if(v.length>0&&(_=v.xdo.global("hoverTargetLastDate"),m=v.xdo.global("hoverTargetLastEDate")),(o&&!isNaN(parseInt(o))||null==o)&&_){var x=n._utils.getUnitsForDate(_);if(x.length>0)return void c(x[0].data.nid)}if(_&&(b=n._utils.getNearestUnitToDate(_))&&(null==o||-4==parseInt(o))&&b&&b.timeDiff/n._defs.ADAYOFMILLIS<12)return void c(b.unit.data.nid);var D=e.lang("New Unit");if(a.nt()!==e.nt.Message.LessonSummary()&&1!=a.args.unitOptional||(D=!1),""!=o&&null!=o&&-4!=parseInt(o)&&(D=o),0==D)return d.child(r,1).remove(),void a.trigger("submit");var y={"bookPlanEntryForm-nodetype":"6.4","bookPlanEntryForm-unit-section-name":D};if(n&&n._config&&n._config.mode==n._config._modes.undated){var U=!1,P=!1;_&&(U=n._utils.isDateInMap(n._utils.dateToISO(_))),m&&(P=n._utils.isDateInMap(n._utils.dateToISO(m))),U&&(y["bookPlanEntryForm-upSIndex"]=""+U[0],y["bookPlanEntryForm-unit-UberPlannerDates-sdate"]=""),P&&(y["bookPlanEntryForm-upEIndex"]=""+P[0],y["bookPlanEntryForm-unit-UberPlannerDates-edate"]="")}else _&&(y["bookPlanEntryForm-unit-UberPlannerDates-sdate"]=n._utils.dateToISO(_)),m&&(y["bookPlanEntryForm-unit-UberPlannerDates-edate"]=n._utils.dateToISO(m));e.post({data:y,url:{command:"create",xds:"bookPlanUnitEntry",nid:e.gbl.nid,nodetype:6,nodesubtype:4},callback:function(e){var t=e.nid;a.args=h,c(t)}}),a.e.stopImmediatePropagation(),a.e.preventDefault()}}},transmogrify:function(a,t,s){if("new"==a.build.buildMode){var i=a.get_arg("xds");a.on("ajax_post",function t(n){n.e.stopPropagation();var s=a.get_parent(1);a.dom().remove(),s.length>0&&s.remove(),e.get_func("UberPlanner.fn.plannerRecalc")(n),n.newEvent("UberPlanner.sheet",{nid:n.cnid(),xds:i}),a.off("ajax_post",t)}),a.trigger("saveEntry")}else{a.args.command="create",a.args.nodetype=a.get_val("nodetype"),a.args.nodesubtype=a.get_val("nodesubtype");var r=a.args.fields;"undefined"!=typeof CKEDITOR&&$.each(CKEDITOR.instances,function(e,a){if(t.find("[name="+e+"]").length){a.updateElement();var n=t.find("[name="+e+"]"),s=n.val();0==s.indexOf("<p>\n\t&nbsp;</p>")&&n.val(s.substr("<p>\n\t&nbsp;</p>".length)),a.resetDirty()}}),a.args.pre_func=function(t){for(var s in r=r.split(","))if(r.hasOwnProperty(s)){var i=r[s].split(":"),d=a.get_val(i[0],"node"),o=a.sibling(i[0],1).find("input"),l=a.find("[name="+i[0]+"]");3!=i.length||d||(d=i[i.length-1]),o.length>0&&o.val()&&(d=o.val()),l.length>0&&l.val()&&(d=l.val()),n._utils.setFieldData(t.slice,i[1],d)}var c=a.get_parent(1);a.dom().remove(),c.length>0&&c.remove(),e.get_func("UberPlanner.fn.plannerRecalc")(a)},n.fn.sheet(a)}},uberPlannerCreateItem:function(a,t,s){var i=a.global("hoverTargetDate");s||(s={item:a.args}),a.args={command:a.get_arg("command")||"create",xds:a.arg(),nodetype:a.arg("nt"),nodesubtype:a.arg("nst"),func:function(e){$(".UberPlanner-create2").hide()},pre_func:function(e){if(i)if(n._config.mode==n._config._modes.undated){var t=n._utils.isDateInMap(i);t.length>0&&n._utils.setFieldData(e.slice,"upIndex",""+t[0])}else{var r=s.item.datefield||a.arg("datefield");n._utils.setFieldData(e.slice,r,n._utils.dateToISO(i))}n._utils.setFieldData(e.slice,a.arg("typefield"),s.item.value);var d=a.arg("nt"),o=a.arg("nst");s&&s.item&&(s.item.nt&&(d=s.item.nt),s.item.nst&&(o=s.item.nst));var l=0;if(s&&s.item&&null!=s.item["calendar-type"]&&(l=s.item["calendar-type"],n._utils.setFieldData(e.slice,"bookPlanEntryForm-assignment-caltype",l),n._utils.setFieldData(e.slice,"caltype",l)),n._utils.setFieldData(e.slice,"bookPlanEntryForm-nodetype",d),n._utils.setFieldData(e.slice,"nodetype",d),s.item.threadfield||a.arg("threadfield")){var c=-4;if(4==d&&14==o&&(c=!1),i){var g=n._utils.getUnitsForDate(i);g.length>0&&(s.item.threadfield||a.arg("threadfield"))&&(c=g[0].data.nid)}n._utils.setFieldData(e.slice,s.item.threadfield||a.arg("threadfield"),c)}}},a.args.command||(a.args.command="create"),s.item.xds&&(a.args.xds=s.item.xds),s.item.nt&&(a.args.nodetype=s.item.nt),s.item.nst&&(a.args.nodesubtype=s.item.nst);var r=s.item.createMode||a.arg("createMode")||"sheet";if("sheet"==r)n.fn.sheet(a);else if("inline"==r){var d=n._utils.getRowForDate(i);a.args.target="#"+d[0].id+" .inlineCreate",e.get_func("loadxds")(a)}},onBodyClick:function(a,t,n){var s=$(".InlineJournalEntry");s.hasClass("xds-form-virgin")?s.trigger("close"):s.trigger("submit"),e.get_func("UberPlanner.fn.hideSheet")(a,t,n)},hideSheet:function(a,t,n){var s=$(".xds-sheet");e.get("forms.preCloseForm")(a,s,function(){s&&"-650px"!=s.css("right")&&(a.global("sheetHidden",!0),s.removeClass("xds-sheet-shown").addClass("xds-sheet-hidden")),a.args&&a.args.clearSheet&&$(".xds-sheet-cont").html("")})},sheet:function(s,i,r){var d=s.global("sheetlastHash"),o=s.global("sheetHidden"),l=$(".xds-sheet"),c=$(".xds-sheet-cont"),g=function e(){s.global("sheetHidden",!0),l.removeClass("xds-sheet-shown").addClass("xds-sheet-hidden"),$(t).off("xds-esc",e)},f=function(){l.css("display","block"),s.global("sheetHidden",!1),l.removeClass("xds-sheet-hidden").addClass("xds-sheet-shown"),$(t).on("xds-esc",g)},p=s.nid()+":"+(s.args.command?s.args.command:"")+":"+s.args.xds;""==c.html()&&(d="");var u=n._config.sheetShowTime,h=new Date;if(r&&"close"==r.command&&(u&&u.getTime()+100<=h.getTime()||!u))o||g();else if(d!=p||o||"create"==s.args.command)if(d==p&&"create"!=s.args.command&&o)f();else{if(s.global("sheetlastHash",p),0==l.length)$("body").append('<div class="xds-sheet xds-sheet-hidden"><i class="far fa-times-circle xds-sheet-close"></i><div class="xds-sheet-cont">&nbsp;</div></div>'),l=$(".xds-sheet"),c=$(".xds-sheet-cont"),$(".xds-sheet-close").on("click",g),l.on("xds-validate-failed",function(){l.animate({scrollTop:0})});"0px"!=l.css("right")&&(l.css("position","fixed").css("top","90px").css("height",$(a).height()-110+"px"),c.css("height",$(a).height()-130+"px"),f()),l.css("display","block").on("ajax_post",function(){g(),s.global("sheetlastHash",-1),$(".UberPlanner").trigger("PlannerDataChanged")}).on("xds-unloadForm",function(){g(),s.global("sheetlastHash",-1)}).on("xds-cancel",function(){g()}),s.args.target=".xds-sheet-cont",s.args.transition=!1,s.args.noPath=!1,s.args.nid=s.cnid(),n._config.t.nt()==e.nt.Container.PLC()&&(s.args.indexedMode=!0),s.global("modelNid")||s.global("modelNid",n._config.t.global("modelNid")),s.args.model=s.global("modelNid"),e.fn.loadxds(s),n._config.sheetShowTime=new Date}else g()},plannerRecalc:function(e){e.e&&$("body").hasClass("xds-UberPlanner-resizeActive")||(n.fn.recalcSize(e),n.fn.recalcUnitPositions(e))},recalcHeight:function(e){n._sanityCheckCallbacks._updatemargin(),n._config.gutter&&n._config.table&&n._config.gutter.css("height",n._config.table.height()+"px")},recalcWidth:function(e){if(n._config.gutter&&n._config.table){var a=n._config.gutter.offset().left,s=t.documentElement.clientWidth-2*a;n._config.table.css("width",s-150),n._config.header.css("width",s+"px")}},recalcSize:function(e){n.fn.recalcHeight(e),n.fn.recalcWidth(e)},recalcUnitPositions:function(e){$("#UberPlannerFakeUnit").removeClass("Unit");var a,t,s=$(".Unit"),i=n._config.gutter.offset().top,r=[];$(".first").removeClass("first"),$(".last").removeClass("last");for(var d=0;d<s.length;d++)if(a=s[d].id.replace("#",""),(t=n._utils.getUnitByID(a))&&t.t){var o=n._utils.getRowForDate(t._parsedSdate),l=o.position(),c=n._utils.getRowForDate(t._parsedEdate),g=c.position();null==l&&(l=(o=$(t.t.id()+"-contents")).position()),null==g&&(c=o,g=l);var f=$("#"+a);if(0==d?f.addClass("first"):d==s.length-1&&f.addClass("last"),g==l?f.addClass("shortUnit"):f.removeClass("shortUnit"),f.css("position","absolute").css("top",l.top-i+"px").css("height",g.top+c.height()-l.top+"px"),r.length>0){var p=r.pop(),u=void 0,h=void 0;if(t._parsedSdate&&p&&p.unit&&p.unit._parsedEdate){for(;r.length>0&&n._utils.compareDatesNoTime(p.unit._parsedEdate,t._parsedSdate)<0;)p=r.pop();h=(u=p.div.position()).left,n._utils.compareDatesNoTime(p.unit._parsedEdate,t._parsedSdate)>=0&&(h=u.left-6,r.push(p)),f.css("left",h+"px")}}r.push({div:f,unit:t})}$("#UberPlannerFakeUnit").addClass("Unit")},unbindPlannerEvents:function(t,n,s){e.get_func("hover.unbindAll")();var i=$(".ui-resizable").off(),r=$(".ui-draggable").off(),d=$(".ui-droppable").off();try{i.resizable("destroy")}catch(e){}try{r.draggable("destroy")}catch(e){}try{d.droppable("destroy")}catch(e){}$(".Unit").off(),$(".Document").off(),$(".xds-UberPlanner-fakeDate").off(),$(".xds-UberPlanner-date:not(.xds-UberPlanner-fakeDate)").off(),$(".Journal").off(),a.setTimeout(function(){i.html(""),r.html(""),d.html("")},1e3)},bindPlannerEvents:function(t,s,i){var r=$("#UberPlannerFakeUnit"),d=function(e,a){for(var t=e.id,s=0;s<n._config._docs.length;s++){var i=n._config._docs[s].t;if(i.id()=="#"+t){var r=i.arg("xdsedit");return i.has_role("Class Owner")||i.has_role("Moderator")||i.has_role("SysAdmin")||i.has_role("District IT Administrator")||(r=i.arg("xdsview")),0==(2&i.get_perm(i.arg("xdsedit")))&&(r=i.arg("xdsview")),i.args={xds:r},void n.fn.sheet(i)}}},o=$(".UberPlanner-create2"),l=(t.id(1),$(".xds-uberPlannerTable-Gutter")),c=($(".xds-uberPlannerTable-Table"),!1);$(".Document:not(.ReportingPeriod):not(.Event), .xds-UberPlanner-fakeDate").on("click",function(e){d(this),e.stopPropagation()}),$(".xds-UberPlanner-date:not(.xds-UberPlanner-fakeDate)").hover(function(e){if(!($(".UberPlanner-create2 .xdl-picker-active").length>0||$(".UberPlannerInlineAssessment").length>0||$(".InlineJournalEntry").length>0)){var s=$(this),i=!1;try{i=n._utils.getDateFromRow(s)}catch(e){return}if(null!=i&&0!=i){var d,g=n._utils.getUnitsForDate(i),f=n._utils.isDateInMap(i);if(c&&c!=s&&c.removeClass("xds-UberPlanner-date-hovered"),s.addClass("xds-UberPlanner-date-hovered"),c=s,0==g.length){for(var p=0;p<n._config.defaultUnitLength-1&&f[0]+p<n._config.dateMap.length-1&&0==n._utils.getUnitsForDate(n._config.dateMap[f[0]+p].date).length;)p++;0!=n._utils.getUnitsForDate(n._config.dateMap[f[0]+p].date).length&&p--;var u=n._config.dateMap[f[0]+p],h=n._utils.getRowForDate(u.date);h.length>0&&(d=h.offset().top+h.height()-s.offset().top,t.global("hoverTargetLastEDate",u.date),r.css("position","absolute").css("top",s.offset().top-l.offset().top+"px").css("height",d+"px").show())}else r.hide();var _=s.position(),m=s.find(".pre"),v=_.top+m.height()+(s.height()-m.height()-o.height())/2+"px",b=$(a).width()-(_.left+s.width()+50)+"px";o.css("position","absolute").css("top",v).css("right",b).css("display","inline-block"),f?(t.global("hoverTargetDate",n._config.dateMap[f[0]].date),t.global("hoverTargetLastDate",n._config.dateMap[f[0]].date)):t.global("hoverTargetDate",!1)}}},function(e){var a=$(this);$(".UberPlanner-create2 .xdl-picker-active").length>0||e.relatedTarget&&(e.relatedTarget.className.indexOf("UberPlanner-create2")>=0||e.relatedTarget.className.indexOf("xds-picker")>=0)||(t.global("hoverTargetDate",!1),a.removeClass("xds-UberPlanner-date-hovered"),o.css("position","").css("top","").css("right","").css("display",""))}),$(".Journal").on("click",function(e){d(this),e.stopPropagation()}),$(".Unit, .fakeUnit").on("click",function(e){e.stopPropagation();var a=this.parentNode.id;if("UberPlannerFakeUnit"==a||"UberPlannerFakeUnit"==this.id){var t=$(".UberPlanner").xdo;t.args={xds:t.arg("xdsunit"),command:"create",nodetype:6,nodesubtype:4,pre_func:function(e){var a=t.global("hoverTargetLastDate"),s=t.global("hoverTargetLastEDate"),i={"bookPlanEntryForm-nodetype":6,"bookPlanEntryForm-nodesubtype":4,"bookPlanEntryForm-unit-section-name":" "};a&&(i["bookPlanEntryForm-unit-UberPlannerDates-sdate"]=n._utils.dateToISO(a),i["bookPlanEntryForm-unit-UberPlannerDates-edate"]=n._utils.dateToISO(s)),i["bookPlanEntryForm-unit-section-thread"]=n._config._termNid,i["bookPlanEntryForm-thread"]=n._config._termNid,n._utils.setFieldData(e.slice,i)}},n.fn.sheet(t)}else if(a=this.id,n._config._unitsByDomID["#"+a]){var s=n._config.units[n._config._unitsByDomID["#"+a]].t,i=s.arg("xdsedit");0==(2&s.get_perm(s.arg("xdsedit")))&&(i=s.arg("xdsview")),s.args={xds:i},n.fn.sheet(s)}}),$(".xds-UberPlanner-fileThumbnail").on("click",function(a){var t=$(this).parents(".xds-UberPlanner-doc");if(t.length>0){var s="#"+t[0].id;if(t=n._config._docMap[s]){var i=t.t;i.args={nid:i.cnid(),xds:"AlbumLightbox"},e.get_func("lightbox")(i),a.stopPropagation(),a.preventDefault()}}}),n._config.gutter.on("mousemove",function(e){n._config.gutter.offset().top;var a=n._utils.getRowForYPosition(e.pageY);if(a){var t=n._utils.getDateFromRow(a);if(t){var s=n._utils.getUnitsForDate(t),i=n._utils.isDateInMap(t);if(0==s.length){for(var d=0;d<n._config.defaultUnitLength-1&&i[0]+d<n._config.dateMap.length-1&&0==n._utils.getUnitsForDate(n._config.dateMap[i[0]+d].date).length;)d++;0!=n._utils.getUnitsForDate(n._config.dateMap[i[0]+d].date).length&&d--;var o=n._config.dateMap[i[0]+d],c=n._utils.getRowForDate(o.date),g=c.offset().top+c.height()-a.offset().top;n._config.t.global("hoverTargetLastDate",t),n._config.t.global("hoverTargetLastEDate",o.date),r.css("position","absolute").css("top",a.offset().top-l.offset().top+"px").css("height",g+"px").show()}else r.hide()}else r.hide()}})},bindDrags:function(s){var i=$(".Unit:not(.xds-Unit-undated)"),r=(n._config.gutter.height(),0),d=function(e){var a=$(t).scrollTop();e.offset.top-a<120&&$(t).scrollTop(a-5)};i.resizable({minWidth:134,maxWidth:134,minHeight:60,handles:"n, s",resize:function(e,a){var s=$(t).scrollTop(),i=n._config.gutter.offset().top;"n"==this.handle&&s+120>i+a.position.top?$(t).scrollTop(s-5):"s"==this.handle&&i+a.position.top+a.size.height>r+s-30&&$(t).scrollTop(s+5)},start:function(e,t){n.fn.hideSheet(s);var i=$(e.srcElement),d=60,o=!1,l=$(this);if(i.length||(i=$(e.toElement)),!i.length&&e.originalEvent&&e.originalEvent.target&&(i=$(e.originalEvent.target)),l.addClass("xds-UberPlanner-unit-resizeActive"),$("body").addClass("xds-UberPlanner-resizeActive"),r=$(a).height(),(o=n._utils.getUnitByID(t.element[0].id))||(o={}),i.hasClass("ui-resizable-n")){if(this.handle="n",o.docs&&o.docs.length>0){for(var c=!1,g=0;g<o.docs.length;g++)if(o.docs[g].data._parsedDate){c=o.docs[g];break}if(c){var f=n._utils.getRowForDate(c.data._parsedDate).offset(),p=l.offset();d=l.height()-(f.top-p.top)}}}else if(this.handle="s",o.docs&&o.docs.length>0){for(var u=!1,h=o.docs.length-1;h>=0;h--)if(o.docs[h].data._parsedDate){u=o.docs[h];break}var _=n._utils.getRowForDate(u.data._parsedDate),m=_.position(),v=l.offset();d=m.top+_.height()-v.top}l.resizable("option","minHeight",d)},stop:function(e,a){var t=$(".xds-UberPlanner-date-real"),s=!1,i=this.handle,r=n._config.gutter.offset().top,d=a.element.offset(),o=!1,l=!1;$(this).removeClass("xds-UberPlanner-unit-resizeActive"),$("body").removeClass("xds-UberPlanner-resizeActive");for(var c=0;c<t.length;c++)if(s=$(t[c]),"n"==i){if(s.position().top<d.top&&s.position().top+s.height()+1>=d.top||0==c&&s.position().top>d.top){var g,f=s.height(),p=s.position(),u=p.top+Math.floor(f/2)+1,h=p.top,_=s;u<d.top&&(h=p.top+s.height(),_=$(t[c+1])),g=h-d.top,o=n._utils.getDateFromRow(_),a.element.css("top",h-r+"px").css("height",a.size.height-g+"px");break}}else{var m=d.top+a.size.height;if(s.position().top<=m&&s.position().top+s.height()>=m||c==t.length-1&&s.position().top<=m){var v=s.height(),b=s.position().top+Math.floor(v/2)+1,x=void 0,D=s.position(),y=s;b>m?(y=$(t[c-1]),x=m-D.top):x=m-(D.top+s.height()),l=n._utils.getDateFromRow(y),a.element.css("height",a.size.height-x+"px");break}}(o||l)&&n.fn.updateUnitDates(a,{newsdate:o,newedate:l})}}),$(".Unit").draggable({handle:".moveHandle",revert:!1,axis:"y",helper:"clone",start:function(e,a){n.fn.hideSheet(s),$(".fakeUnit").css("visibility","hidden");var t=$(this),i=n._utils.getUnitByID(t[0].id);this._unit=i,$(this).addClass("dragMoveActive"),this._clones=[],this._cloneMap={};for(var r=0;r<i.docs.length;r++){var d=i.docs[r].t.id(1).clone(!1);d.length>0&&(d.addClass("xds-drag-cloned"),d[0].id="xds-clone-"+r,this._clones.push(d),this._cloneMap[i.docs[r].t.id()]=d)}this._dayRows=$(".xds-UberPlanner-date-real")},drag:function(a,t){d(t);for(var i=this._dayRows,r=!1,o=n._config.gutter.offset().top,l=t.offset,c=!1,g=$(this),f=this,p=0;p<i.length;p++)if((r=$(i[p])).position().top<l.top&&r.position().top+r.height()+1>=l.top||0==p&&r.position().top>l.top){var u=r.height(),h=r.position(),_=h.top+Math.floor(u/2)+1,m=h.top,v=r;_<l.top&&(m=h.top+r.height(),v=$(i[p+1])),c=n._utils.getDateFromRow(v),g.css("top",m-o+"px");break}(c&&this._lastsdate&&this._lastsdate!=c||!this._lastsdate)&&(this._lastsdate=c,function(a){f._copyAltProps||(f._copyAltProps=e.get_func("copierGetAltProps")(s,null,"move"),f._copyBufferObj=e.get_func("copier._utils.processSelection")(f._unit.t,"move"));var t=f._copyAltProps;if(t.fromDate=a,f._unit._parsedSdate&&0==n._utils.compareDatesNoTime(e.parseDate(a),f._unit._parsedSdate))$(".xds-drag-cloned").css("display","none");else{for(var i=e.get_func("mapSchedules")(s,f._copyBufferObj,t),r=0;r<f._unit.docs.length;r++){var d=f._unit.docs[r],o=f._cloneMap[d.t.id()];if(d.data._parsedDate){var l=n._utils.getRowForDate(i[e.dateFormat(d.data._parsedDate,"yyyy-mm-dd HH:MM:ss")]),c=e.dateFormat(d.data._parsedDate,"yyyy-mm-dd");for(var g in i)if(i.hasOwnProperty(g)&&g.indexOf(c)>=0){l=n._utils.getRowForDate(i[g]);break}var p=l.find(".documents");o.appendTo(p).css("display","block"),p.css("display","inline-block")}}n.fn.recalcUnitPositions(s)}}(c))},stop:function(a,t){var i=$(this);$(".fakeUnit").css("visibility",""),i.removeClass("dragMoveActive"),this._unit._parsedSdate&&this._lastsdate&&0==n._utils.compareDatesNoTime(e.parseDate(this._lastsdate),this._unit._parsedSdate)?i.draggable("option","revert",!0):this._lastsdate&&(i.draggable("option","revert",!1),n._config.gearModeEnabled=!0,n.fn.updateUnitAndAllDocuments(t,i,this._lastsdate)),$(".xds-drag-cloned").remove(),delete this._clones,n.fn.recalcUnitPositions(s)}}),$(".Unit:not(.fakeUnit)").droppable({accept:".Document, .Journal",drop:function(e,a){var t=n._utils.getUnitByID(this.id);n.fn.updateDocumentUnit(a,t.t.nid())},over:function(e,a){$(this).addClass("xds-hover-hoverable-hovered")},out:function(e,a){$(this).removeClass("xds-hover-hoverable-hovered")}}),$(".Document:not(.ReportingPeriod):not(.Event), .Journal").draggable({revert:"invalid",helper:"clone",start:function(e,a){n.fn.hideSheet(s),$(a.helper).addClass("ui-draggable-helper"),$(this).addClass("dragActive")},drag:function(e,a){d(a)},stop:function(e,a){$(this).removeClass("dragActive")}}),$(".Unit").on("xdsHoverIn",function(e,a){var t=n._utils.getUnitByID(this.id);if(t){for(var s=0;s<t.docs.length;s++)t.docs[s].t.id(1).addClass("unitHoverActive");for(var i=0;i<t.undatedDocs.length;i++)t.undatedDocs[i].t.id(1).find(".Document").addClass("unitHoverActive")}}).on("xdsHoverOut",function(e,a){var t=n._utils.getUnitByID(this.id);if(t){for(var s=0;s<t.docs.length;s++)t.docs[s].t.id(1).removeClass("unitHoverActive");for(var i=0;i<t.undatedDocs.length;i++)t.undatedDocs[i].t.id(1).find(".Document").removeClass("unitHoverActive")}}),$(".xds-UberPlanner-date").droppable({accept:".Document, .Journal",activeClass:"",greedy:!0,hoverClass:"xds-UberPlanner-date-highlight",tolerance:"intersect",drop:function(e,a){var t=n._utils.getDateFromRow($(this));n.fn.updateDocumentDate(a,t)}})},updateUnitAndAllDocuments:function(a,t,n){var s=t[0]._unit;if(s){var i=s.t;i.global("unitMoveDate",n);e.get_func("copier.move")(i)}},mergeUnits:function(a){for(var t=e.dialog({message:e.lang("Working, please wait...")+"<br/>"+e.html.loading(),buttons:[]}),s=a[0],i={no_ajax_post:!0},r=[],d=[],o=1;o<a.length;o++){var l=a[o],c=n._config.units[l];d.push(c);for(var g=0;g<c.docs.length;g++)r.push(c.docs[g])}!function a(){if(i.func=a,r.length>0){var o=r.pop();n.fn.doUpdateDocumentUnit(o.t,s,i)}else if(d.length>0){var l=d.pop().t;e.post({url:{command:"delete",xds:l.arg("xdsdel"),nid:l.cnid()},callback:function(e){a()}})}else e.get_func("copyComplete")(n._config.t),t.remove()}()},doUpdateDocumentUnit:function(a,t,n){if(a.args={action:e.gen_url({command:"node",xds:a.arg("xdsdrag"),nid:a.cnid()}),data:{thread:t}},n)for(var s in n)n.hasOwnProperty(s)&&(a.args[s]=n[s]);a.data.assdate&&(a.args.data.assdate=a.data.assdate,a.args.data.duedate=a.data.assdate),e.get_func("post")(a)},updateDocumentUnit:function(e,a){var t=e.draggable[0].id,s=n._config._docMap["#"+t];if(s&&s.t){var i=s.t;n.fn.doUpdateDocumentUnit(i,a)}},updateDocumentDate:function(a,t){var s=a.draggable[0].id,i=n._utils.isDateInMap(e.parseDate(t)),r=!1;i&&(t=n._config.dateMap[i[0]].date);n._utils.getUnitsForDate(t);for(var d=0;d<n._config._docs.length;d++)if((r=n._config._docs[d]).t.id()=="#"+s){var o=r.t,l=o.arg("xdsdrag");if(!l)return void e.dialog({message:"ERROR: No Drag XDS Defined",buttons:[{name:"ok",text:e.lang("Ok")}]});if(o.args={action:e.gen_url({command:"node",xds:l,nid:o.cnid()}),data:{thread:-1}},n._config.mode==n._config._modes.undated)for(var c=["upIndex"],g=n._utils.isDateInMap(t),f=0;f<c.length;f++)o.args.data[c[f]]=""+g[0];else for(var p=o.arg("dragkey").split(":"),u=e.get("copier"),h=0;h<p.length;h++)u.setDateField(o.args.data,p[h],t);return-1==o.args.data.thread&&(delete o.args.data.thread,r.data.thread&&(o.args.data.thread=r.data.thread)),void e.get_func("post")(o)}},updateUnitDates:function(a,t){var s={};if(t.newsdate){s.sdate=t.newsdate;var i=n._utils.isDateInMap(e.parseDate(s.sdate));i&&(s.sdate=n._config.dateMap[i[0]].date)}if(t.newedate){s.edate=t.newedate;var r=n._utils.isDateInMap(e.parseDate(s.edate));r&&(s.edate=n._config.dateMap[r[0]].date)}var d=n._utils.getUnitByID(a.element[0].id);if(d){var o=d.t,l=o.arg("xdsresize");if(!l)return void e.dialog({message:"ERROR: No Resize XDS Defined",buttons:[{name:"ok",text:e.lang("Ok")}]});if(o.args={action:e.gen_url({command:"node",xds:l,nid:o.cnid()}),data:{}},n._config.mode==n._config._modes.undated){var c=n._utils.isDateInMap(d._parsedSdate),g=n._utils.isDateInMap(d._parsedSdate);s.sdate&&(c=n._utils.isDateInMap(s.sdate)),o.args.data.upSIndex=""+c[0],o.args.data[o.arg("startkey")]="",s.edate&&(g=n._utils.isDateInMap(s.edate)),o.args.data.upEIndex=""+g[0],o.args.data[o.arg("endkey")]=""}else o.args.data[o.arg("startkey")]=s.sdate,o.args.data[o.arg("endkey")]=s.edate;e.get_func("post")(o),s.sdate&&(d.sdate=s.sdate,d._parsedSdate=e.parseDate(d.sdate)),s.edate&&(d.edate=s.edate,d._parsedEdate=e.parseDate(d.edate)),n.fn.plannerRecalc(d.t)}else n._config.t.global("hoverTargetLastDate",s.sdate),n._config.t.global("hoverTargetLastEDate",s.edate)},doRenderUnitUndatedEvents:function(a,t,s){for(var i=[],r={4.14:"xds-contains-Journal",6.5:"xds-contains-Lesson",6.3:"xds-contains-Assessment",6.2:"xds-contains-Event"},d=0;d<s.undatedDocs.length;d++){var o="",l=s.undatedDocs[d],c={body:l.data.body||"",todo:l.data.todo||"",id:l.t.id().replace("#",""),name:l.data.name||"",prefix:l.data._type||l.data.type||"",classNames:s.colorClass+(3==l.data.state?" xds-UberPlanner-hidden":""),post:"",file:n._utils.generateFileHTML(l.t,l.data.file),cbClass:"xds-copier-copyInput"},g="";c.prefix.length>0&&(c.prefix+=": "),"4.14"==l.t.nt()?(c.classNames+=" Journal",g=e.tpl(n.Generators.templates.Journal,c)):("6.5"==l.t.nt()?(c.prefix="Lesson: ",c.classNames+=" Lesson"):c.classNames+=" Assessment",g=e.tpl(n.Generators.templates.Doc,c)),r[l.t.nt()]&&(o=r[l.t.nt()]);var f={id:l.t.id().replace("#",""),html:g,datestr:e.lang("Set <br/> Date"),classNames:o};n._config.mode==n._config._modes.undated&&(f.datestr=e.lang("Drag to<br/>Set<br/>Date")),0==(2&l.t.get_perm(l.t.arg("xdsedit")))&&(f.datestr=e.lang("No <br/> Date")),i.push(e.tpl(n.Generators.templates.fakeDayRow,f))}return i},renderUnitUndatedEvents:function(e){var t=$(".xds-UberPlanner-date"),s=[];for(var i in n._config.units)if(n._config.units.hasOwnProperty(i)){var r=n._config.units[i],d=$(r.t.id());if(r.undatedDocs.length>0&&d)for(var o=d.offset(),l=n.fn.doRenderUnitUndatedEvents(e,null,r),c=0;c<t.length;c++){var g=$(t[c]),f=g.position();if(f&&o&&f.top==o.top){var p=g.find(".pre");s.push({pre:p,html:l.join("")})}}}for(var u=0;u<s.length;u++)s[u].pre.append(s[u].html);n.fn.recalcUnitPositions(e),n.fn.restorePlannerFilters(e),a.setTimeout(function(){n.fn.recalcUnitPositions(e),n.fn.restorePlannerFilters(e)},1e3)},restorePlannerFilters:function(a,n,s){var i=e.storage("UberPlanner-filters"),r=t.location.href.split("#").pop(),d=!1;if(r){r=decodeURI(r);try{i=r=JSON.parse(r),r.hasOwnProperty("saveFilters")&&(d=r.saveFilters)}catch(e){}}for(var o in i)i.hasOwnProperty(o)&&i[o]&&(!0,e.get_func("UberPlanner.fn.toggleFilter")(a,n,{filter:o,value:!0,saveFilters:d}),"schedule"==o&&$(".UberPlanner-header-commands-right-dayfilters").xdo.picker.set_val(2))},plannerFiltersChanged:function(a,t,n){var s="",i=!1;if(a.id().indexOf("dayfilters")>=0&&(s="schedule","2"==n.value&&(i=!0),e.storage("UberPlanner-filters").schedule==i))return;a.id().indexOf("assessments")>=0&&(s="assessments"),a.id().indexOf("events")>=0&&(s="events"),a.id().indexOf("journal")>=0&&(s="journals"),a.id().indexOf("lessons")>=0&&(s="lessons"),e.get_func("UberPlanner.fn.toggleFilter")(a,t,{filter:s})},verifyFilterCheckbox:function(e,a,t){n.fn.restorePlannerFilters(e);var s="";e.id().indexOf("dayfilters")>=0&&(s="schedule"),e.id().indexOf("assessments")>=0&&(s="assessments"),e.id().indexOf("events")>=0&&(s="events"),e.id().indexOf("journal")>=0&&(s="journals"),e.id().indexOf("lessons")>=0&&(s="lessons");var i=n._defs.filterMap[s];$(".UberPlanner").hasClass(i.hidden)&&i.selector&&i.selector.checkbox&&($(i.selector.checkbox+".xds-f_checkbox").removeClass("xds-f_checkbox-checked"),$(i.selector.checkbox+" input").prop("checked",""),$(i.selector.checkbox+" input").attr("value",0))},toggleFilter:function(a,t,s){for(var i=$(".xds-UberPlanner-date"),r=$("body").scrollTop(),d=$(".UberPlanner-header"),o=$(".UberPlanner"),l=!1,c=5,g=d.position().top+d.height(),f=0;f<i.length&&!l;f++){var p=$(i[f]);p.position().top>=r+g&&p.is(":visible")&&p.height()>0&&(l=p,c=p.position().top-(r+g))}var u,h;u=s.filter,h=n._defs.filterMap[u],s.filter==u&&(s.hasOwnProperty("value")?o.hasClass(h.hidden)&&!s.value?o.removeClass(h.hidden).addClass(h.visible):s.value&&o.addClass(h.hidden).removeClass(h.visible):o.toggleClass(h.hidden).toggleClass(h.visible));for(var _={schedule:o.hasClass("xds-UberPlanner-hideSchedule"),assessments:o.hasClass("xds-UberPlanner-hideAssessments"),events:o.hasClass("xds-UberPlanner-hideEvents"),journals:o.hasClass("xds-UberPlanner-hideJournals"),lessons:o.hasClass("xds-UberPlanner-hideLessons")},m=0;m<i.length;m++)$(i[m]).css("height","").css("max-height","").css("min-height","").css("overflow-y","").css("border","");if(_.schedule)for(var v=0;v<i.length;v++){for(var b=i[v],x=$(b).find(".documents div"),D=!1,y=0;y<x.length;y++)if($(x[y]).is(":visible")){D=!0;break}D||$(b).css("height","0px").css("max-height","0px").css("min-height","0px").css("overflow-y","hidden").css("border","none")}try{n.fn.recalcUnitPositions(a)}catch(e){}var U=!0;if(s&&s.hasOwnProperty("saveFilters")&&(U=s.saveFilters),U&&e.storage("UberPlanner-filters",_),l)for(var P=$(".xds-UberPlanner-date"),k=!1,C=0;C<P.length;C++){var T=$(P[C]);if(T[0].id==l[0].id&&(k=!0),k&&T.is(":visible")&&T.height()>0){var w=T.position().top-g-c;$("body").scrollTop(w);break}}n.fn.recalcSize(a)},getCalendarEvents:function(a,t,s){n._config.mode!=n._config._modes.undated&&(a.args.func=function(e){a.trigger("xds-uberPlanner-moreDataLoaded")},e.get_func("loadxds")(a))},renderPlannerTable:function(t,s,i){$(".UberPlanner-header-commands-right .xds-field-label").removeClass("xds-field-label").addClass("xds-field-uberplanner-label");t.id(1);var r,d,o=$(".xds-uberPlannerTable-Gutter"),l=$(".xds-uberPlannerTable-Table"),c=$(".UberPlanner-header-courseHeader"),g=$(".UberPlanner-header-commands"),f=[],p=[],u=[],h=[];for(r in 0==c.length&&(c=$(".UberPlanner-header-placeHeader")),n._config.gutter=o,n._config.units)n._config.units.hasOwnProperty(r)&&((d=n._config.units[r]).sdate?u.push(d):h.push(d));var _=['<div class="Undated">'];for(r=0;r<h.length;r++){var m=h[r];_.push("<div class='xds-UberPlanner-UndatedUnitContents' id='"+m.t.id().replace("#","")+"-contents'>");var v=n.fn.doRenderUnitUndatedEvents(t,s,m);v.length>0?_.push(v.join("")):_.push("<div class='xds-UberPlanner-noContents'>"+e.lang("This unit has no assessments")+"</div>"),_.push("</div>")}for(_.push("</div>"),f.push(_.join("")),r=0;r<h.length;r++)p.push(n.Generators.Unit(h[r],r+1,e.lang("Unit ")+(r+1),"xds-Unit-undated"));for(u.sort(function(e,a){return e._parsedSdate-a._parsedSdate}),r=0;r<u.length;r++)p.push(n.Generators.Unit(u[r],h.length+r+1));2==(2&t.get_perm(t.arg("xdsunit")))&&p.push(e.tpl(n.Generators.templates.Unit,{id:"UberPlannerFakeUnit",name:e.lang("Click here to add unit"),number:e.lang("New Unit"),classNames:"fakeUnit"})),o.html(p.join("")),a.setTimeout(function(){for(var a=0;a<u.length;a++)e.get_func("hover.register")(u[a].t);for(var t=0;t<h.length;t++)e.get_func("hover.register")(h[t].t)},100),$("#UberPlannerFakeUnit").hide(),n._config.table=l,n._config.header=c,n._config.header2=g;var b=t.get_perm()>1||n._config.mode==n._config._modes.undated;n._config._docs=n._config._docs.sort(function(e,a){return(e.data._parsedDate?e.data._parsedDate.getTime():0)-(a.data._parsedDate?a.data._parsedDate.getTime():0)});var x=0;for(r=0;r<n._config.dateMap.length;r++)(n._config.dateMap[r].scheduled&&b||!n._config.dateMap[r].scheduled||n._config.dateMap[r].hasItems)&&(x!=n._config.dateMap[r].parsed.getFullYear()&&n._config.mode!=n._config._modes.undated&&(x=n._config.dateMap[r].parsed.getFullYear(),f.push(n.Generators.YearRow(x))),f.push(n.Generators.DateRow(r)));b||$(".UberPlanner-header-commands-right-checkboxes-schedule").remove(),l.html(f.join("")),n.fn.plannerRecalc(t),n.fn.renderUnitUndatedEvents(t),2==(2&t.get_perm(t.arg("xdsedit")))&&n.fn.bindDrags(t),n.fn.bindPlannerEvents(t),t.trigger("xds-uberPlanner-tableRendered"),n._config._rows=$(".xds-UberPlanner-date"),n._config._scrollAfterLoad&&(n._config._scrollAfterLoad=!1,n.fn.uberPlannerScrollToToday(t))},onResize:function(e){e.timeout||(e.timeout=a.setTimeout(function(){e.trigger("resized"),e.timeout=!1},50))}},types:{plannerSeedDate:function(e){var a=n._utils.getNormalizedDates(e.data);return n._config._seedDates[e.arg("seedKey")]=a,!1},plannerTerm:function(e){return n._config._termNid=e.nid(),!1},plannerUnit:function(a){if(!a.data)return!1;var t=a.data.fraction;t=t?t.split("/"):[a.rnode.rid,1];var s={t:a,data:a.data,docs:[],undatedDocs:[],fraction:t,id:a.id(),typeMap:{}};return n._utils.sanityCheckDates(a),n._utils.sanityCheckUnitNames(a),a.data.sdate&&(n._utils.addDateToForwardMap(a.data.sdate,!1,!0),s._parsedSdate=e.parseDate(a.data.sdate),s.sdate=a.data.sdate),a.data.edate?(n._utils.addDateToForwardMap(a.data.edate,!1,!0),s._parsedEdate=e.parseDate(a.data.edate),s._parsedSdate&&s._parsedSdate.getTime()>s._parsedEdate.getTime()?(s._parsedEdate=s._parsedSdate,s.edate=a.data.sdate):s.edate=a.data.edate):s._parsedEdate=s._parsedSdate,3==a.data.state&&(a.has_role("Class Owner")||a.has_role("Moderator")||a.has_role("SysAdmin")||a.has_role("District IT Administrator"))||3!=a.data.state?(n._config.units[a.rnode.nid]=s,n._config._unitsByDomID[a.id()]=a.rnode.nid):n._config._hiddenUnits[a.rnode.nid]=s,!1},plannerDocument:function(a){if("6.24"!=a.nt()&&n._config._docNidMap[a.nid()])return!1;n._config.hasSchedule&&a.arg("plannerIsEvent");var t=!1;if(n._utils.sanityCheckDates(a),a.data.body&&(a.data.body=e.get("sanitizer").sanitize(a.data.body,"richtext")),a.data.todo&&(a.data.todo=e.get("sanitizer").sanitize(a.data.todo,"richtext")),n._config.units[a.data.thread]||n._config._hiddenUnits[a.data.thread]){var s=n._config.units[a.data.thread];if(s||(s=n._config._hiddenUnits[a.data.thread]),3==s.data.state&&(a.data.state=3),s.docs.push({t:a,data:a.data}),a.data.sdate){if(a.data._parsedDate=e.parseDate(a.data.sdate),!a.data._parsedDate){var i=$("<div>").html(a.data.sdate).text();a.data._parsedDate=e.parseDate(i),a.data.sdate=i}t=a.data.sdate}if(a.data.assdate){if(a.data._parsedDate=e.parseDate(a.data.assdate),!a.data._parsedDate){var r=$("<div>").html(a.data.assdate).text();a.data._parsedDate=e.parseDate(r),a.data.assdate=r}t=a.data.assdate}a.data.duedate&&(a.data._parsedDate=e.parseDate(a.data.duedate),t=a.data.duedate),a.data._parsedDate?(s.docs=s.docs.sort(function(e,a){return(e.data._parsedDate?e.data._parsedDate.getTime():0)-(a.data._parsedDate?a.data._parsedDate.getTime():0)}),s.sdate||(s.sdate=t,s._parsedSdate=a.data._parsedDate,n._utils.addDateToForwardMap(s.sdate,!1,!0)),s.edate||(s.edate=t,s._parsedEdate=a.data._parsedDate,n._utils.addDateToForwardMap(s.edate,!1,!0)),s._parsedSdate.getTime()>a.data._parsedDate.getTime()&&(s.sdate=t,s._parsedSdate=a.data._parsedDate,n._utils.addDateToForwardMap(s.sdate,!1,!0)),s._parsedEdate.getTime()<a.data._parsedDate.getTime()&&(s.edate=t,s._parsedEdate=a.data._parsedDate,n._utils.addDateToForwardMap(s.edate,!1,!0))):(3==a.data.state&&(a.has_role("Class Owner")||a.has_role("Moderator")||a.has_role("SysAdmin")||a.has_role("District IT Administrator"))||3!=a.data.state)&&(s.undatedDocs.push({t:a,data:a.data}),n._config.t.nt()!=e.nt.Container.PLC()&&a.nt()==e.nt.Document.Assignment()&&n.recordSanityCheck("assessmentDates",a))}else{if(a.data.sdate){if(a.data._parsedDate=e.parseDate(a.data.sdate),!a.data._parsedDate){var d=$("<div>").html(a.data.sdate).text();a.data._parsedDate=new Date(Date.parse(d)),a.data.sdate=e.dateFormat(a.data._parsedDate,"yyyy-mm-dd")}t=a.data.sdate}a.nt()!=e.nt.Document.ReportingPeriod()&&a.nt()!=e.nt.Message.LessonSummary()&&a.nt()!=e.nt.Document.Discussion()&&(a.data.thread&&a.data.thread!=a.data.nid?n.recordSanityCheck("orphaned",a):a.data&&!a.data.thread&&(a.data.thread=a.data.nid,n.recordSanityCheck("orphaned",a)))}a.data.upIndex&&(a.data.upIndex=parseInt(a.data.upIndex),n._config._maxIndex?n._config._maxIndex<a.data.upIndex&&(n._config._maxIndex=a.data.upIndex):n._config._maxIndex=a.data.upIndex);var o={t:a,data:a.data};return(3==a.data.state&&(a.has_role("Class Owner")||a.has_role("Moderator")||a.has_role("SysAdmin")||a.has_role("District IT Administrator"))||3!=a.data.state)&&(n._config._docs.push(o),n._config._docMap[a.id()]=o,n._config._docNidMap[a.nid()]=o,t&&n._utils.addDateToForwardMap(t,!1,!0)),!1},uberPlanner:function(e){n._config&&(e.nid(),n._config.lastnid),n._config={t:e,dateMap:[],reverseDateMap:{},defaultUnitLength:7,units:{},_hiddenUnits:{},_docs:[],_sanityChecks:{},_modes:{schedule:0,undated:1,calendar:2},_docMap:{},_docNidMap:{},_unitsByDomID:{},stats:{assessments:0,journals:0,units:0,lessons:0},_seedDates:{},_scrollAfterLoad:!1,lastnid:e.nid()},e.global("copierFunctionPrefix","UberPlanner").addClass("xds-UberPlanner-showLessons").addClass("xds-UberPlanner-showAssessments").addClass("xds-UberPlanner-showJournals").addClass("xds-UberPlanner-showSchedule"),e.inherit("page"),e.ready(function(){$("body").removeClass("xds-UberPlanner-undated"),n._config.mode==n._config._modes.undated&&$("body").addClass("xds-UberPlanner-undated")}),e.on(a,"resize",n.fn.onResize)},plannerDateMap:function(a){if(a.data&&a.data.meetings){for(var t=0;t<a.data.meetings.length;t++){var s=a.data.meetings[t];n._config.scheduleStart||(n._config._scheduleStart=s),n._utils.addDateToForwardMap(s,!0),t>n._config.nClasses-1&&(n._config.nClasses=t+1)}n._config.mode=n._config._modes.schedule,n._config.hasSchedule=!0}return a.nt()==e.nt.Container.Course()||a.nt()==e.nt.Container.PLC()?n._config.mode=n._config._modes.undated:a.data&&a.data.meetings&&0!=a.data.meetings.length||(n._config.mode=n._config._modes.calendar),!1},plannerBuildReverseDateMap:function(e){return n._utils.rebuildReverseDateMap(),!1},plannerData:function(e){e.tag("div")},plannerTable:function(a){if(n._config.mode==n._config._modes.undated||n._config.mode==n._config._modes.calendar){var t=new Date,s=new Date;if(n._config.mode==n._config._modes.calendar)if(t.setMonth(7),t.setDate(1),s.setMonth(4),s.setDate(30),n._config._seedDates.startDate&&n._config._seedDates.startDate.parsedDate)t=n._config._seedDates.startDate.parsedDate,(s=new Date(t.getTime())).setFullYear(s.getFullYear()+1);else{var i=new Date;t.getTime()>i.getTime()&&t.setFullYear(t.getFullYear()-1),s.getTime()<i.getTime()&&s.setFullYear(s.getFullYear()+1)}else n._config.dateMap.length>0&&(t=n._config.dateMap[0].parsed,s.setTime(n._config.dateMap[n._config.dateMap.length-1].parsed.getTime()));s.setMonth(s.getMonth()+1);for(;n._config._maxIndex&&n._config._maxIndex+10>n._config.dateMap.length||n._utils.compareDatesNoTime(t,s)<=0;){0;var r=!0;0!=t.getDay()&&6!=t.getDay()||(r=!1),r&&n._utils.addDateToForwardMap(t,!0);var d=t.getTime();(t=new Date).setTime(d+n._defs.ADAYOFMILLIS)}for(var o in n._config.units)if(n._config.units.hasOwnProperty(o)){var l=n._config.units[o];if(l.data.upSIndex){var c=n._config.dateMap[l.data.upSIndex];c&&(!l._parsedSdate||l._parsedSdate.getTime()>c.parsed.getTime())&&(l._parsedSdate=c.parsed,l.sdate=c.date,l.data.sdate=l.sdate)}if(l.data.upEIndex){var g=n._config.dateMap[l.data.upEIndex];g&&(!l._parsedEdate||l._parsedEdate.getTime()<g.parsed.getTime())&&(l._parsedEdate=g.parsed,l.edate=g.date,l.data.edate=l.edate)}else!l.data.upEIndex&&l.data.upSIndex&&(l._parsedEdate=l._parsedSdate,l.edate=l.sdate,l.data.edate=l.edate)}for(var f=0;f<n._config._docs.length;f++){var p=n._config._docs[f];if(void 0!==p.data.upIndex){var u=n._config.dateMap[p.data.upIndex],h=n._config.units[p.data.thread];if(p.data._parsedDate=u.parsed,p.data.sdate=u.date,h)for(var _=0;_<h.undatedDocs.length;_++)if(h.undatedDocs[_].t.id()==p.t.id()){(h._parsedSdate&&h._parsedSdate.getTime()>u.parsed.getTime()||!h._parsedSdate)&&(h._parsedSdate=u.parsed,h.sdate=u.date),(h._parsedEdate&&h._parsedEdate.getTime()<u.parsed.getTime()||!h._parsedEdate)&&(h._parsedEdate=u.parsed,h.edate=u.date);break}}}}else n._utils.addDateToForwardMap(new Date,!1,!0);n._config.mode!=n._config._modes.undated&&n._utils.addDateToForwardMap(new Date,!1,!0),a.tag("div").preclosetag("<div class='xds-uberPlannerTable-Gutter'>&nbsp;</div><div class='xds-uberPlannerTable-Table'></div>").ready(function(){n.fn.renderPlannerTable(a);var t=e.storage("UberPlanner-targetNid",void 0,"sessionStorage");if(e.storage("UberPlanner-targetNid",-1,"sessionStorage"),t){var s=n._config._docNidMap[t];if(s||(s=n._config.units[t]),s){var i=s.t.id(1);i.length>0&&i.trigger("click")}}var r=function(a,t){e.diagnosticMessage('UberPlanner Sanity Check "'+a+'" ('+t+")","UberPlanner Sanity Check")},d={assessmentDates:!0,unitNames:!0};if(2&a.get_perm()){var o={unitNames:function(e){var a=[];for(var t in e)e.hasOwnProperty(t)&&e[t].length>1&&a.push(e[t]);return a}};for(var l in o)o.hasOwnProperty(l)&&n._config._sanityChecks.hasOwnProperty(l)&&(n._config._sanityChecks[l]=o[l](n._config._sanityChecks[l]));for(var c in n._config._sanityChecks)n._config._sanityChecks.hasOwnProperty(c)&&n._config._sanityChecks[c].length>0&&(n._sanityCheckCallbacks[c]&&n._sanityCheckCallbacks[c](n._config._sanityChecks[c]),d[c]||r(c,n._config._sanityChecks[c].length));try{for(var g in n._config.units)n._config.units.hasOwnProperty(g)&&0;for(var f=0;f<n._config._docs.length;f++)"6.3"==n._config._docs[f].t.nt()&&0}catch(e){}}else n._sanityCheckCallbacks._updatemargin(),$(".UberPlanner-create2").remove();n.fn.restorePlannerFilters(a)})}}};return e.extend.fn({bpDeleteButtonShowIf:function(e,a){return!1},copyComplete:function(e,a,t){return n.fn.copyComplete(e,a,t)},copierGetAltProps:function(e,a,t){return n.fn.copierGetAltProps(e,a,t)},xcopierGetSelection:function(e,a,t){return n.fn.copierGetSelection(e,a,t)}}),n});
});
